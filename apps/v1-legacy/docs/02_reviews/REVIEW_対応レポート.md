# Voice KY Assistant レビュー対応レポート

対応完了日: 2026-01-21
対象: Voice KY Assistant MVP

---

## 対応サマリー

| レビュー | 対応済 | 見送り |
| -------- | ------ | ------ |
| 実装レビュー（第1回）| 4件 | 4件 |
| 実装レビュー（再）| 2件 | 5件 |
| 辛口レビュー（第2回）| 3件 | 8件 |
| **合計** | **9件** | **17件** |

---

## 見送り方針の確定事項

以下はユーザー判断により、MVPでは対応を見送ることが確定した事項です。

| 項目 | 理由 |
| ---- | ---- |
| **無認証API + CORS `*`** | 自分の端末のみ使用、1人運用の前提。外部公開時に対応。 |
| **OpenAI利用のレート制限** | 自己利用のため悪用リスクなし。 |
| **PDF日本語フォント埋め込み** | 8MB超のフォント埋め込みはMVP工数として過大。英語ラベルで対応済み。 |
| **会話ログの保持期間/削除導線** | 端末内のみ保存、監査要件なし。 |

---

## 実装レビュー対応詳細

### 第1回（REVIEW_実装.md）

#### ✅ 対応済み

| 重要度 | 指摘 | 対応内容 |
| ------ | ---- | -------- |
| 高 | XSS注入の脆弱性 | `UI.escapeHtml()`追加、chat.js/confirm.js適用 |
| 中 | 「修正」導線が壊れている | 会話履歴を復元してチャット画面に遷移 |
| 中 | PDFが日本語フォント非対応 | 英語ラベルへフォールバック |
| 低 | 現場名入力欄がID重複 | 重複を削除 |

#### ⏸️ 見送り

| 重要度 | 指摘 | 見送り理由 |
| ------ | ---- | ---------- |
| 高 | 全APIが認証なし＋CORS `*` | 自己端末運用前提（確定事項） |
| 中 | 同期APIが実質ダミー | 即時同期で動作、バッチ不要 |
| 中 | 会話ログの保持/削除設計がない | 監査要件なし（確定事項） |
| 低 | 履歴取得が全件取得→reverse | MVP規模では問題なし |

---

### 再レビュー（REVIEW_実装_再レビュー.md）

#### ✅ 対応済み

| 重要度 | 指摘 | 対応内容 |
| ------ | ---- | -------- |
| 中 | 天候表示のHTML挿入が未エスケープ | `chat.js`で`UI.escapeHtml()`適用 |
| 低 | オフライン初回失敗時のAI挨拶がログに残らない | フォールバック時も`addMessage()`を追加 |

#### ⏸️ 見送り

| 重要度 | 指摘 | 見送り理由 |
| ------ | ---- | ---------- |
| 高 | 無認証API + CORS `*` | 確定事項 |
| 高 | OpenAI利用のレート制限なし | 自己利用（確定事項） |
| 中 | PDF日本語フォント未対応 | 8MB超（確定事項） |
| 中 | 会話ログの保持期間/削除導線 | 確定事項 |
| 低 | PDF改行/長文折返し未対応 | 軽微なUX課題 |

---

## 辛口レビュー（第2回）対応詳細

#### ✅ 対応済み

| 重要度 | 指摘 | 対応内容 |
| ------ | ---- | -------- |
| 高 | done.jsのXSSエスケープ漏れ | `UI.escapeHtml()`適用 |
| 高 | history.jsのXSSエスケープ漏れ | `UI.escapeHtml()`適用 |
| 中 | index.jsの重複コメント | 削除 |

#### ⏸️ 見送り

| 重要度 | 指摘 | 見送り理由 |
| ------ | ---- | ---------- |
| 高 | handleSyncがダミーのまま | 即時同期で動作 |
| 中 | API.baseUrlの判定がlocalhostのみ | MVP運用で支障なし |
| 中 | jsPDFの外部CDN依存 | オフライン完全対応は必須要件外 |
| 中 | 履歴詳細がalertで表示 | UX課題、v2で対応 |
| 中 | 音声読み上げ中に認識が始まる可能性 | 実機テストで確認後に対応 |
| 低 | グローバル関数が多い | MVP規模で問題なし |
| 低 | 作業種別がハードコード | MVP要件は足場設置のみ |
| 低 | エラーハンドリングのログが不統一 | 動作に影響なし |

---

## XSS対策 完了状況

| ファイル | 対象箇所 | 状況 |
| -------- | -------- | ---- |
| `ui.js` | `escapeHtml()` 関数 | ✅ 実装済み |
| `chat.js` | メッセージ表示、天候表示 | ✅ 適用済み |
| `confirm.js` | 危険/対策/合言葉/アドバイス | ✅ 適用済み |
| `done.js` | 合言葉表示 | ✅ 適用済み |
| `history.js` | 履歴一覧のサマリー | ✅ 適用済み |

---

## 今後の対応ロードマップ

| フェーズ | 対応項目 | 優先度 |
| -------- | -------- | ------ |
| パイロット運用後 | 音声読み上げ中の認識停止 | 高（問題発生時） |
| パイロット運用後 | 履歴詳細画面の改善 | 中 |
| v2開発 | handleSyncのバルクINSERT | 中 |
| v2開発 | jsPDFローカル化 | 中 |
| v2開発 | 作業種別の選択対応 | 低 |
| 外部公開時 | 認証・CORS制限 | 高 |
| 外部公開時 | レート制限 | 高 |
