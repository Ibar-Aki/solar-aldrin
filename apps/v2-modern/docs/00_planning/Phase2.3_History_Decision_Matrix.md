# Phase 2.3 機能判定シート (Decision Matrix)

**目的**: Phase 2.3 (履歴管理・データ永続化) で実装する機能の詳細を整理し、要否判定の材料とする。

**作成日**: 2026-01-30

---

## 📍 Phase 2.3 の位置づけ (Renumbered)

> **履歴管理・データ永続化 (History & Persistence)**
> 端末内に過去のKY記録を保存し、ユーザーが振り返れるUIを提供する。また、Phase 2.7 (AI用参照データ) の基盤データとしても機能させる。

**技術的ハードル**:

- **低 (Low)**: ブラウザの `IndexedDB` (Dexie.js等) を使用すれば、サーバー不要で数万件の保存・検索が可能。

**完了条件**:

- 過去のKY記録が端末に保存される
- ユーザーが過去の記録を一覧・詳細表示できる
- AIが過去の記録を参照できる状態になる (Phase 2.7への接続)

---

## 📅 Phase 2.3 機能候補

### HIS-01: ローカルデータベース実装 (IndexedDB)

| 項目 | 内容 |
| :--- | :--- |
| **概要** | ブラウザ内のデータベース (IndexedDB) にKY記録を永続保存する |
| **技術** | `Dexie.js` 等のラッパーを使用し、堅牢なデータ保存を実現 |
| **目的** | リロードしても消えない、長期的な記録保持 |
| **推奨案** | ✅ **採用**（Phase 2.7 の前提機能） |

---

### HIS-02: 履歴一覧・詳細UI

| 項目 | 内容 |
| :--- | :--- |
| **概要** | 過去のKY記録をリスト表示し、タップで詳細（PDF内容相当）を確認できる画面 |
| **推奨案** | ✅ **採用**（ユーザー待望の機能） |

---

### HIS-03: 履歴からの「引用・再利用」

| 項目 | 内容 |
| :--- | :--- |
| **概要** | 過去の「現場名」や「作業内容」をコピーして、新規セッションを開始する |
| **推奨案** | ⏸ **条件付き採用**（「危険・対策」はコピーさせず、基本情報のみコピーならOK） |

---

### HIS-04: CSV/JSON データエクスポート

| 項目 | 内容 |
| :--- | :--- |
| **概要** | 蓄積されたローカルデータを CSV や JSON ファイルとしてダウンロードする |
| **推奨案** | ✅ **採用**（ローカル運用の不安「データ消失」をカバー） |

---

## 📊 判定サマリ

| ID | 機能名 | コスト | 推奨 (A-C) | ユーザー判定 | 実装状況 | 備考 |
| :--- | :--- | :--- | :---: | :--- | :--- | :--- |
| **HIS-01** | ローカルDB実装 | 低 | A | ✅ **採用** | ✅ 実装済 | Dexie.js使用 |
| **HIS-02** | 履歴一覧UI | 中 | A | ✅ **採用** | ✅ 実装済 | /history, /history/:id |
| **HIS-03** | 履歴引用開始 | 低 | B | ✅ **採用** | ✅ 実装済 | 基本情報のみ |
| **HIS-04** | データエクスポート | 低 | B | ✅ **採用** | ✅ 実装済 | CSV/JSON対応 |
