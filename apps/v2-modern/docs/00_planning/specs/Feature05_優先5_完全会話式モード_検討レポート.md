# 3: 完全会話式モード（音声のみ完結）検討レポート（v2-modern）

- 作成日時: 2026-02-06 23:31:11 +09:00
- 作成者: Codex＋GPT-5
- 対象: スタート後に音声のみでKY完了できる会話モード
- 検討前提: 2番機能（自動音声出力）を発展させる
- 本レポート作成見積: 2.5時間

## 1. 背景と現状

現状は以下です。

- 音声入力: Web Speech API（`useVoiceRecognition`）
- 音声出力: Web Speech API（`useTTS`）
- 会話制御: テキストチャットAPI（`/api/chat`）
- 制約: 音声は補助機能であり、完全ハンズフリー体験には未到達

## 2. 解決したい課題

- 利用者が画面操作せず会話を継続したい
- 発話割り込み、再開、聞き直しなど音声会話特有の制御が必要
- 低遅延と安定性を両立したい

## 3. 選択肢比較

| 案 | 内容 | 体験品質 | 実装難易度 | 備考 |
| --- | --- | --- | --- | --- |
| A | Web Speech API継続で擬似音声会話 | 中 | 中 | 既存活用しやすい |
| B | OpenAI Realtime API（WebRTC中心） | 高 | 高 | 低遅延・自然な会話 |
| C | ハイブリッド（Aを当面、本命B） | 高 | 高 | 移行リスクを抑えやすい |

## 4. 推奨案

**推奨: C（段階的ハイブリッド）**

- Phase 1: 既存Web Speech基盤で「音声会話モードUI」を先行実装
- Phase 2: Realtime API（WebRTC）へ切替して真の低遅延会話へ移行

採用理由:

- 早期にUX検証ができる
- Realtime移行時の破壊的変更を抑えられる
- 現場端末差（ブラウザ差異）へのフォールバックを持てる

## 5. 変更仕様（UI/API/型/運用）

### 5.1 新規モード

- `会話モード: 通常 / 完全会話式` をホームで選択
- 完全会話式では、入力欄を最小化し音声状態を主表示

### 5.2 セッションAPI

- Workersに新規ルート（例: `POST /api/realtime/client-secret`）
- クライアントは短命シークレットで接続
- 音声接続が失敗した場合は自動で通常モードへフォールバック

### 5.3 状態遷移

- 主要状態: `idle`, `listening`, `thinking`, `speaking`, `interrupted`, `error`
- 割り込み時: 応答停止、必要に応じて会話トランケーション

### 5.4 UX要件

- 聞き直しコマンド（例: 「もう一度」）
- 一時停止/再開コマンド
- 音声権限拒否時のガイド表示

### 5.5 ログ・運用

- 音声接続成功率
- 平均往復レイテンシ
- 割り込み成功率

## 6. 実装工数概算

| 作業 | 工数（人日） | 内容 |
| --- | --- | --- |
| モードUI/状態機械 | 2.5 | 画面・状態管理 |
| Realtime接続基盤 | 3.5 | WebRTC/イベント処理 |
| WorkersシークレットAPI | 1.5 | セッション発行 |
| 割り込み・再開制御 | 2.0 | 中断処理 |
| フォールバック実装 | 1.5 | 通常モード退避 |
| テスト（端末差含む） | 3.0 | unit/e2e/実機 |
| 合計 | **14.0人日** |  |

スコープ拡張（音声コマンド拡充、監視強化）込みで **16.0〜18.0人日**。

## 7. テスト観点

- 音声のみで開始→完了まで到達できる
- 利用者割り込みで応答が正しく停止・再開する
- マイク権限未許可時に安全にフォールバック
- ネットワーク劣化時の再接続・モード復帰

## 8. リスクと対策

- リスク: モバイルブラウザ差で挙動不安定
  - 対策: WebRTC失敗時の通常モード退避を必須化
- リスク: 音声会話の誤認識
  - 対策: 重要確認は復唱フローを導入
- リスク: 実装範囲拡大
  - 対策: フェーズ分割（先にUX、次にRealtime）

## 9. 受け入れ基準

- 音声のみで1セッション完了できる
- 割り込み・聞き直しが主要端末で安定動作
- 失敗時に利用継続可能なフォールバックがある

## 10. 公式参照

- Realtime conversations: https://platform.openai.com/docs/guides/realtime-conversations
- Realtime guide: https://platform.openai.com/docs/guides/realtime
- Latest model guidance: https://platform.openai.com/docs/guides/latest-model
