# Phase 2.3 レポート（コンテキスト注入/ナレッジ循環）

参照: `docs/00_planning/Phase2.3_Decision_Matrix.md`
作成日: 2026-01-30

---

## 1. エグゼクティブサマリ
- **総合推奨度**: **A-**（価値が大きいが、データ設計とコスト管理が鍵）
- **主な価値**: 「毎回同じ助言」問題の解消、現場固有のリスク再利用
- **主な懸念**: プロンプト肥大/ノイズ、保存・削除・匿名化ポリシーの未整備

---

## 2. 観点別レビュー（多角的評価）
### 2.1 価値・現場効果
- 繰り返しのヒヤリハットを再提示できる点はKYの質を底上げ。
- 「昨日の指摘」を出すことで短期リスクを強調でき、現場の気づきに直結。

### 2.2 UX（体験）
- 情報量が増えすぎると、注意喚起が散漫になるリスク。
- 過去情報の扱いに「押しつけ感」が出ると反発を生む。

### 2.3 技術・実装
- 保存基盤（LocalStorage/IndexedDB）とプロンプト注入の設計が中核。
- データ量増加でトークン超過の可能性があり、圧縮/要約が必要。

### 2.4 運用・ガバナンス
- 保存期間/削除ポリシーの明確化が不可欠（現場名/個人情報の取り扱い）。
- データの誤りや古い情報をどう扱うかの運用ルールが必要。

### 2.5 リスク・品質
- 誤った過去データを再利用し続ける「誤学習の固定化」リスク。
- ノイズが増えると「毎回同じ助言」問題が再発する可能性。

---

## 3. 機能別評価（詳細）

| ID | 機能 | 価値 | 実装コスト | 運用負荷 | 主なリスク | 推奨度 | コメント |
| --- | --- | --- | --- | --- | --- | --- | --- |
| CTX-01 | 過去ヒヤリハット参照 | 高 | 中 | 中 | トークン肥大 | **A** | ナレッジ循環の核心。まずここを最小構成で実装。 |
| CTX-02 | 昨日の指摘参照 | 中〜高 | 低 | 低 | データ欠損時の挙動 | **A** | CTX-01の派生。効果が高くコスト低。 |
| CTX-03 | 簡易RAG | 中 | 中〜高 | 中 | 検索精度/ノイズ | **C** | 効果検証後に検討。最初は範囲限定が良い。 |
| CTX-04 | 天候・曜日文脈 | 中 | 低 | 低 | 決めつけ/固定観念 | **B** | 低コスト。提示文の言い回し工夫が必要。 |
| CTX-05 | 現場固有ナレッジ | 高 | 中 | 高 | 登録運用負担 | **D** | Phase 3.0のプラットフォーム設計と統合が妥当。 |

---

## 4. 推奨実装順（MVP → 拡張）
1. **CTX-01**: 過去ヒヤリハット参照（件数・期間を限定して開始）
2. **CTX-02**: 昨日の指摘参照（短期リスク強調）
3. **CTX-04**: 天候・曜日文脈（低コストで効果追加）
4. **CTX-03**: 簡易RAG（検索精度の検証後）
5. **CTX-05**: 現場固有ナレッジ（運用体制整備後）

---

## 5. 成果測定（KPI例）
- 「同じ助言」と感じる率の低下
- 過去ヒヤリハット再指摘率（再提示数 / セッション数）
- 重要危険の具体性スコアの改善
- セッション完了率の変化（負荷増による低下がないか）

---

## 6. リスクと対策
- **トークン肥大**: 過去データは要約・件数制限・類似度スコアで絞る
- **古い情報の固定化**: 「最終更新日」や「過去情報」ラベルを付ける
- **情報の押し付け感**: 「参考例」として提示し、選択権を残す

---

## 7. 結論
Phase 2.3はナレッジ循環の中核であり、**CTX-01/02/04の最小構成から段階導入**が最適です。運用負荷が大きい機能（CTX-05）はPhase 3.0で再設計するのが安全です。
