# 音声読み上げ速度 切替機能 詳細計画書（v2）

作成日: 2026-01-30
対象: Voice KY Assistant v2-modern

---

## 1. 概要
音声読み上げ（TTS）の速度を「遅く(0.8) / 標準 / 少し早く(1.25) / 早く(1.5)」から選択できるようにし、ユーザー体験の最適化と現場ごとの読み上げ体感差を吸収する。

---

## 2. 背景・現状
- v2では `useTTS` が `SpeechSynthesisUtterance.rate` を固定値で設定している。
- 直近対応で標準速度を **1.2** に変更済み（既定値）。
- 現場の環境（騒音・作業者の年齢層・端末差）により最適速度が異なるため、ユーザー選択式が必要。

---

## 3. 目的・ゴール
- 4段階のプリセットで速度を切替可能にする。
- 選択値は次回起動時も保持する（永続化）。
- 既存の音声読み上げ機能・音声認識制御を壊さない。

---

## 4. スコープ
### 対象
- v2-modern のフロントエンド（TTS設定・UI・永続化）

### 対象外
- v1-legacy の変更
- 音声認識（SpeechRecognition）の精度改善
- 音声合成エンジンの差し替え

---

## 5. 要件
### 5.1 機能要件
1. 速度プリセットを4段階で選択できる。
2. 現在選択中の速度がUIで分かる。
3. 選択変更後、次回の読み上げに即時反映される。
4. 選択値は永続化され、再読み込み後も保持される。
5. TTS未対応環境では速度UIを無効化または非表示にする。

### 5.2 非機能要件
- 既存のTTS停止・排他制御に影響を与えない。
- UIは操作数が増えない場所（ヘッダーまたは入力周辺）に配置。
- モバイル環境でもタップしやすいサイズで提供。

---

## 6. 仕様詳細
### 6.1 速度プリセット定義
| 表示 | 値(rate) | 備考 |
| --- | --- | --- |
| 遅く | 0.8 | 落ち着いた読み上げ |
| 標準 | 1.2 | **既定値（現状の標準）** |
| 少し早く | 1.25 | 標準よりわずかに早い |
| 早く | 1.5 | 速読相当 |

※「標準=1.0」にしたい場合は別途確認が必要（未確定事項に記載）。

### 6.2 UI/UX
- **配置案**: チャットフッター上部またはヘッダー下に「読み上げ速度」セレクタを配置。
- **形式**: 4択のセグメントボタン or ラジオボタン。
- **ラベル**: 「遅く / 標準 / 少し早く / 早く」
- **補足表示**: tooltip や小さな補助テキストで倍率を表示（例: 0.8x）。

### 6.3 状態管理（Zustand）
- `useTTSStore` に速度状態を追加。
- 例: 
  - `rate: number`
  - `setRate: (rate: number) => void`
  - `preset: 'slow' | 'standard' | 'fast' | 'faster'`

### 6.4 永続化
- `zustand/middleware` の `persist` を利用。
- 例: `name: 'voice-ky-v2-tts-settings'`
- 保存対象は `rate` と `preset` のみ。

### 6.5 TTS適用
- `useTTS` の `utterance.rate` に store の `rate` を適用。
- 既存の停止・排他制御の流れは維持。

---

## 7. 実装タスク（詳細）
1. **ストア拡張**
   - `src/stores/useTTSStore.ts` に速度設定と更新関数を追加。
   - `persist` を導入し設定を保存。

2. **TTSフック連携**
   - `src/hooks/useTTS.ts` で `rate` をストアから取得し反映。

3. **UI追加**
   - 新規コンポーネント `src/components/TTSSpeedSelector.tsx` を作成。
   - `KYSessionPage` または `ChatInput` 周辺に配置。
   - `isSupported` が false の場合は非表示または disabled。

4. **デザイン調整**
   - `src/index.css` もしくは Tailwind クラスで簡易レイアウト。

5. **テスト追加**
   - Zustand store の初期値/永続化ユニットテスト。
   - E2E で速度切替と読み上げ反映を確認。

---

## 8. 受け入れ基準（AC）
- 速度プリセット4段階がUIで選択できる。
- 選択後に読み上げ速度が変化する。
- ページリロード後も選択が保持される。
- TTS非対応環境では速度UIが無効/非表示となる。

---

## 9. テスト計画
### 9.1 手動テスト
- 各速度を選択 → 直後の読み上げ速度が変化するか確認。
- ページ更新後に速度が保持されているか確認。
- iPhone/Safari でもUIが操作可能か確認。

### 9.2 自動テスト案
- Store: 既定値・`setRate` の挙動・永続化復元。
- UI: クリック時に選択状態が変わること。

---

## 10. リスク・留意点
- ブラウザによって rate の実際の体感が異なる可能性。
- Safari で `speechSynthesis.getVoices()` のタイミング差があるため、UIはTTSの可否と独立させる。
- 速度変更が読み上げ中に適用される場合の挙動（次回読み上げから反映）を明記。

---

## 11. 変更影響
- 既存のTTS制御（停止・排他）に影響なし。
- UIに1要素追加されるため、画面レイアウト確認が必要。

---

## 12. 未確定事項
- **「標準=1.2」で良いか**（現行既定値と整合するため 1.2 を提案）。
- UI配置位置（ヘッダー寄せ vs 入力欄付近）の最終判断。

---

以上。
