# リポジトリ全体レビュー（点数推移つき）と対応状況

- 作成日時: 2026-02-07 09:43:10+09:00
- 作成者: Codex+gpt-5
- 更新日: 2026-02-07
- 更新内容: Git履歴の実キー混入有無を確認し、結果を反映

## 1. 目的
本ドキュメントは、solar-aldrin リポジトリの改善点について「何が問題か」だけでなく、次を一目で判断できるようにするためのメモです。

- 点数（観点別）と推移
- 必須/推奨/任意の優先度
- 対応状況（対応済み/未対応/要確認）

## 2. 点数（推移）
### 2.1 スコア推移（総合）
| 日付 | 総合 | 変更点（要約） |
|---|---:|---|
| 2026-02-07 | 5.8/10 | 初回レビュー（旧版） |
| 2026-02-07 | 6.7/10 | 文書/サンプルからキーっぽい文字列とローカルリンクを除去、CI導入を確認、テスト実行の誤記を訂正 |

### 2.2 観点別スコア推移
| 観点 | 2026-02-07 初回 | 2026-02-07 更新 | 理由（更新の要点） |
|---|---:|---:|---|
| セキュリティ | 2/10 | 4/10 | 文書/サンプルの取り扱いを改善。ただし「過去に実キーがGit履歴に混入したか」は未確定のため上限を抑制。 |
| パフォーマンス | 6/10 | 6/10 | 体感/計測に基づく改善は未着手（必要性が出てからでよい）。 |
| コード品質 | 7/10 | 7/10 | console出力など“改善余地”は残るが、重大な破綻は未確認。 |
| テスト | 4/10 | 6/10 | 「テスト0件」系の誤記を訂正し、ローカルでユニットテストが走る前提がある。CI（Unit+Lint+Build）も用意。 |
| アーキテクチャ | 8/10 | 8/10 | 大枠は妥当。現時点で再設計は不要。 |
| ドキュメント | 8/10 | 9/10 | ローカルパスリンクを排除し、運用ガイド等の表現を是正。 |

補足:
- 点数は「今の段階でのリスクと運用負債」を優先して付けています（見た目の綺麗さより、事故るかどうか）。

## 3. 必須/推奨の対応状況（2026-02-07）
### 3.1 必須（P0）
1. 秘匿情報の混入リスクを潰す（文書・サンプル）
   - 状態: 対応済み（現行ファイルからは除去）
   - 実施内容:
     - ルート `README.md` のローカルリンクを削除し、更新日を追記
     - `apps/v2-modern/.dev.vars.example` を「実キーっぽい文字列」を含まないプレースホルダに変更
     - `apps/v2-modern/docs/PHASE2_SETUP.md` / `apps/v2-modern/docs/20_manuals/03_OPS_GUIDE.md` のキー表現を一般化
     - `apps/v1-legacy` 側の例示もプレースホルダに変更
   - 例外:
     - `apps/v2-modern/workers/observability/logger.ts` に「キー形式を検出する正規表現」が残ります（監査/マスキング目的のため、削除しません）。

2. 実費E2E（課金が発生し得るテスト）がCIで誤実行されない
   - 状態: 対応済み（方針）
   - 根拠:
     - CIワークフローは `npm run lint` / `npm test` / `npm run build` のみで、E2E（Playwright）は実行しない。

3. 「過去に実キーがGit履歴へ混入したか」の確認
   - 状態: 確認済み（実キー混入は検出されず）
   - 確認結果（要点）:
     - Git履歴に「実キー形式（長い `sk-...`）」が入ったコミットは検出されませんでした（正規表現で長さ閾値つき検索）。
     - `apps/v2-modern/.dev.vars` は履歴に存在せず、Gitオブジェクトとしても見つかりませんでした。
     - ただし「`sk-` という接頭辞を含む例示（ダミー/説明文）」は過去コミットで検出されました。これは実キーではありません（本日、現行ファイルからは除去済み）。
   - 参考（`sk-` 例示が含まれていた過去コミット）:
     - 2f8ec77, 2e6f3b6, 62ebd2b, d39a933, 6f9fc89, b4ad327
   - 運用上の注意:
     - 万一、過去にキーを第三者へ共有・貼り付け・送信した可能性がある場合は、履歴混入が無くてもローテーションを推奨します（運用判断）。

### 3.2 推奨（P1）
1. CI（GitHub Actions）で Unit+Lint+Build を自動実行
   - 状態: 対応済み
   - ファイル: `.github/workflows/v2-modern-ci.yml`

2. READMEのローカルパスリンク排除
   - 状態: 対応済み
   - ファイル: `README.md`

## 4. 任意（P2）
1. console出力方針の統一（構造化ログ/監視）
2. Viteのチャンク最適化（必要性が出てから）
3. カバレッジ計測（やるなら“重要フロー”優先で）

## 5. 指摘一覧（見やすい版）
以下は「何が問題か」を素早く掴むための短縮版です（詳細は個別ファイルとPR差分で追います）。

### セキュリティ
1. 秘匿情報（APIキー等）の混入
   - 重要度: CRITICAL
   - 状態: 部分対応（文書/サンプルは是正、過去履歴は要確認）
   - 関連:
     - `apps/v2-modern/.gitignore`（`.dev.vars` を無視）
     - `apps/v2-modern/.dev.vars`（ローカル開発用。Gitに含めない）

2. 推測可能な固定トークン運用の誘発（例ファイル）
   - 重要度: MEDIUM
   - 状態: 対応済み
   - 関連:
     - `apps/v2-modern/.env.example`（注意書き＋空値化）

### テスト/品質
3. テストが実行されない（旧版の誤記）
   - 重要度: HIGH（誤記のまま放置すると判断を誤る）
   - 状態: 訂正済み
   - 関連:
     - `apps/v2-modern/tests/unit`（ユニットテスト群）

4. CIで自動テストが回らない
   - 重要度: HIGH（回帰を見逃す）
   - 状態: 対応済み
   - 関連:
     - `.github/workflows/v2-modern-ci.yml`（Unit+Lint+Build）

### ドキュメント
5. ローカル環境依存のリンク（ローカルパス）混入
   - 重要度: MEDIUM
   - 状態: 対応済み
   - 関連:
     - `README.md`

