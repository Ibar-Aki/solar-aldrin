# テストケース全件カタログ（v2-modern）

作成日時: 2026-02-19 23:43:18 +09:00
作成者: Codex (GPT-5)
更新日: 2026-02-19

## サマリー

- Unit: 171件
- Integration: 44件
- E2E: 8件
- 合計: 223件
- 注記: ご要望の「220件」について、実ファイルからの再集計結果は **223件** でした。

## 抽出ルール

- 対象: `apps/v2-modern/tests/**/*.test.ts(x)` と `apps/v2-modern/tests/**/*.spec.ts`
- カウント対象: `it(...)` / `test(...)`
- `describe(...)` はケース文脈として補助利用

## 全223件（詳細）

| ID | Layer | Category | File | Context | Case | 失敗時の影響 | 検証内容（詳細） |
|---:|---|---|---|---|---|---|---|
| 1 | E2E | UI/UX | `apps/v2-modern/tests/e2e/ios_compatibility.spec.ts:4` |  | HomePage loads correctly on WebKit | ユーザー操作不能・UI回帰につながる可能性 | Condition: HomePage loads correctly on WebKit. Expected: behavior/state/result is correct (E2E). |
| 2 | E2E | UI/UX | `apps/v2-modern/tests/e2e/ios_compatibility.spec.ts:28` |  | PDF Generation capability check | ユーザー操作不能・UI回帰につながる可能性 | Condition: PDF Generation capability check. Expected: behavior/state/result is correct (E2E). |
| 3 | E2E | UI/UX | `apps/v2-modern/tests/e2e/ky-session-e2e.spec.ts:33` |  | 標準フロー: 開始からPDF完了まで (Happy Path) | ユーザー操作不能・UI回帰につながる可能性 | 条件: 標準フロー: 開始からPDF完了まで (Happy Path)。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 4 | E2E | 機能整合 | `apps/v2-modern/tests/e2e/ky-session-e2e.spec.ts:125` |  | 高所作業フロー（コンテキスト入力確認） | 主要フロー破綻を見逃す可能性 | 条件: 高所作業フロー（コンテキスト入力確認）。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 5 | E2E | 機能整合 | `apps/v2-modern/tests/e2e/ky-session-e2e.spec.ts:149` |  | 最小入力・エッジケース | 主要フロー破綻を見逃す可能性 | 条件: 最小入力・エッジケース。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 6 | E2E | 機能整合 | `apps/v2-modern/tests/e2e/live-ai-chat.spec.ts:14` |  | Live API: Real chat flow with OpenAI | 主要フロー破綻を見逃す可能性 | Condition: Live API: Real chat flow with OpenAI. Expected: behavior/state/result is correct (E2E). |
| 7 | E2E | UI/UX | `apps/v2-modern/tests/e2e/pdf-visual.spec.ts:6` |  | PDF debug preview visual regression | ユーザー操作不能・UI回帰につながる可能性 | Condition: PDF debug preview visual regression. Expected: behavior/state/result is correct (E2E). |
| 8 | E2E | 観測性/性能 | `apps/v2-modern/tests/e2e/real-cost-scenario.spec.ts:599` |  | Real-Cost: Full KY Scenario with Reporting | 劣化検知遅延・運用判断ミスにつながる可能性 | Condition: Real-Cost: Full KY Scenario with Reporting. Expected: behavior/state/result is correct (E2E). |
| 9 | Integration | 機能整合 | `apps/v2-modern/tests/integration/feedback.test.ts:69` | Feedback API Integration | 正常系で200とフィードバック本文を返す | 仕様回帰の見逃しにつながる可能性 | 条件: 正常系で200とフィードバック本文を返す。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 10 | Integration | 機能整合 | `apps/v2-modern/tests/integration/feedback.test.ts:90` | Feedback API Integration | 同一セッション・同一クライアントの2回目はキャッシュヒットする | 仕様回帰の見逃しにつながる可能性 | 条件: 同一セッション・同一クライアントの2回目はキャッシュヒットする。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 11 | Integration | 機能整合 | `apps/v2-modern/tests/integration/feedback.test.ts:105` | Feedback API Integration | キャッシュTTLを過ぎると再取得する | 仕様回帰の見逃しにつながる可能性 | 条件: キャッシュTTLを過ぎると再取得する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 12 | Integration | 耐障害性 | `apps/v2-modern/tests/integration/integration.test.ts:10` | Chat API Integration Flow | should process chat request and return structured JSON | 本番で会話停止・失敗率増加につながる可能性 | Condition: process chat request and return structured JSON. Expected: behavior/state/result is correct (Integration). |
| 13 | Integration | 機能整合 | `apps/v2-modern/tests/integration/integration.test.ts:67` | Chat API Integration Flow | AI_POLICY_VERSION が設定されている場合は policyVersion に最優先で反映する | 仕様回帰の見逃しにつながる可能性 | 条件: AI_POLICY_VERSION が設定されている場合は policyVersion に最優先で反映する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 14 | Integration | セキュリティ | `apps/v2-modern/tests/integration/integration.test.ts:102` | Chat API Integration Flow | AI_POLICY_VERSION 未設定時は SENTRY_RELEASE を policyVersion として使う | 仕様回帰の見逃しにつながる可能性 | 条件: AI_POLICY_VERSION 未設定時は SENTRY_RELEASE を policyVersion として使う。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 15 | Integration | 機能整合 | `apps/v2-modern/tests/integration/integration.test.ts:136` | Chat API Integration Flow | AI_PROVIDER=gemini のとき Gemini OpenAI互換エンドポイントと既定モデルを使用する | 仕様回帰の見逃しにつながる可能性 | 条件: AI_PROVIDER=gemini のとき Gemini OpenAI互換エンドポイントと既定モデルを使用する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 16 | Integration | 耐障害性 | `apps/v2-modern/tests/integration/integration.test.ts:196` | Chat API Integration Flow | Geminiのfinish_reason=lengthでもJSONが妥当なら、即時フォールバックを発生させない | 本番で会話停止・失敗率増加につながる可能性 | 条件: Geminiのfinish_reason=lengthでもJSONが妥当なら、即時フォールバックを発生させない。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 17 | Integration | 耐障害性 | `apps/v2-modern/tests/integration/integration.test.ts:235` | Chat API Integration Flow | Gemini失敗時のOpenAIフォールバックでは、OpenAI向けjson_schema形式と OPENAI_MODEL を使用して再実行する | 本番で会話停止・失敗率増加につながる可能性 | 条件: Gemini失敗時のOpenAIフォールバックでは、OpenAI向けjson_schema形式と OPENAI_MODEL を使用して再実行する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 18 | Integration | 耐障害性 | `apps/v2-modern/tests/integration/integration.test.ts:313` | Chat API Integration Flow | Geminiの429は既定ではOpenAIへフォールバックしない | 本番で会話停止・失敗率増加につながる可能性 | 条件: Geminiの429は既定ではOpenAIへフォールバックしない。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 19 | Integration | 耐障害性 | `apps/v2-modern/tests/integration/integration.test.ts:340` | Chat API Integration Flow | ENABLE_PROVIDER_FALLBACK=1 のとき Geminiの429をOpenAIへフォールバックする | 本番で会話停止・失敗率増加につながる可能性 | 条件: ENABLE_PROVIDER_FALLBACK=1 のとき Geminiの429をOpenAIへフォールバックする。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 20 | Integration | 機能整合 | `apps/v2-modern/tests/integration/integration.test.ts:386` | Chat API Integration Flow | Geminiは GEMINI_* 設定を優先して runtime/profile に反映する | 仕様回帰の見逃しにつながる可能性 | 条件: Geminiは GEMINI_* 設定を優先して runtime/profile に反映する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 21 | Integration | 耐障害性 | `apps/v2-modern/tests/integration/integration.test.ts:452` | Chat API Integration Flow | should generate a facilitative fallback reply when reply is empty or generic | 本番で会話停止・失敗率増加につながる可能性 | Condition: generate a facilitative fallback reply when reply is empty or generic. Expected: behavior/state/result is correct (Integration). |
| 22 | Integration | 機能整合 | `apps/v2-modern/tests/integration/integration.test.ts:492` | Chat API Integration Flow | should fall back to asking countermeasures when extracted is missing but user just sent risk level | 仕様回帰の見逃しにつながる可能性 | Condition: fall back to asking countermeasures when extracted is missing but user just sent risk level. Expected: behavior/state/result is correct (Integration). |
| 23 | Integration | 機能整合 | `apps/v2-modern/tests/integration/integration.test.ts:527` | Chat API Integration Flow | should fall back to asking risk level when extracted is missing but user seems to explain a cause | 仕様回帰の見逃しにつながる可能性 | Condition: fall back to asking risk level when extracted is missing but user seems to explain a cause. Expected: behavior/state/result is correct (Integration). |
| 24 | Integration | 機能整合 | `apps/v2-modern/tests/integration/integration.test.ts:560` | Chat API Integration Flow | actionGoal入力時に ask_goal が返っても、確認フェーズ向けに補正する | 仕様回帰の見逃しにつながる可能性 | 条件: actionGoal入力時に ask_goal が返っても、確認フェーズ向けに補正する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 25 | Integration | 耐障害性 | `apps/v2-modern/tests/integration/integration.test.ts:605` | Chat API Integration Flow | should handle malformed JSON from OpenAI gracefully | 本番で会話停止・失敗率増加につながる可能性 | Condition: handle malformed JSON from OpenAI gracefully. Expected: behavior/state/result is correct (Integration). |
| 26 | Integration | 耐障害性 | `apps/v2-modern/tests/integration/integration.test.ts:657` | Chat API Integration Flow | finish_reason=length でJSONが壊れた場合は1回だけ再生成して回復できる | 本番で会話停止・失敗率増加につながる可能性 | 条件: finish_reason=length でJSONが壊れた場合は1回だけ再生成して回復できる。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 27 | Integration | 機能整合 | `apps/v2-modern/tests/integration/integration.test.ts:717` | Chat API Integration Flow | finish_reason=length で空文字応答でも再生成して回復できる | 仕様回帰の見逃しにつながる可能性 | 条件: finish_reason=length で空文字応答でも再生成して回復できる。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 28 | Integration | 耐障害性 | `apps/v2-modern/tests/integration/integration.test.ts:777` | Chat API Integration Flow | should return invalid json error without additional OpenAI recovery calls | 本番で会話停止・失敗率増加につながる可能性 | Condition: return invalid json error without additional OpenAI recovery calls. Expected: behavior/state/result is correct (Integration). |
| 29 | Integration | セキュリティ | `apps/v2-modern/tests/integration/integration.test.ts:829` | Chat API Integration Flow | OPENAI_MAX_TOKENS をリクエストと meta.server.maxTokens に反映する | 不正アクセス許容・本番遮断不備につながる可能性 | 条件: OPENAI_MAX_TOKENS をリクエストと meta.server.maxTokens に反映する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 30 | Integration | セキュリティ | `apps/v2-modern/tests/integration/integration.test.ts:874` | Chat API Integration Flow | quick プロファイルでは max_tokens/retry を縮小し、meta.server に反映する | 不正アクセス許容・本番遮断不備につながる可能性 | 条件: quick プロファイルでは max_tokens/retry を縮小し、meta.server に反映する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 31 | Integration | 耐障害性 | `apps/v2-modern/tests/integration/integration.test.ts:934` | Chat API Integration Flow | quick プロファイルで soft timeout 後に hard timeout で回復した場合、tier を soft_recovered で返す | 本番で会話停止・失敗率増加につながる可能性 | 条件: quick プロファイルで soft timeout 後に hard timeout で回復した場合、tier を soft_recovered で返す。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 32 | Integration | 耐障害性 | `apps/v2-modern/tests/integration/integration.test.ts:985` | Chat API Integration Flow | quick プロファイルで soft/hard timeout の両方が失敗した場合、AI_TIMEOUT(hard) を返す | 本番で会話停止・失敗率増加につながる可能性 | 条件: quick プロファイルで soft/hard timeout の両方が失敗した場合、AI_TIMEOUT(hard) を返す。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 33 | Integration | 耐障害性 | `apps/v2-modern/tests/integration/integration.test.ts:1010` | Chat API Integration Flow | スキーマ不整合時は要約付きdetailsを返す | 本番で会話停止・失敗率増加につながる可能性 | 条件: スキーマ不整合時は要約付きdetailsを返す。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 34 | Integration | 機能整合 | `apps/v2-modern/tests/integration/integration.test.ts:1067` | Chat API Integration Flow | should keep system prompt fixed and move external context into a user reference message | 仕様回帰の見逃しにつながる可能性 | Condition: keep system prompt fixed and move external context into a user reference message. Expected: behavior/state/result is correct (Integration). |
| 35 | Integration | 機能整合 | `apps/v2-modern/tests/integration/integration.test.ts:1153` | Chat API Integration Flow | should compact extracted fields by removing null/empty values | 仕様回帰の見逃しにつながる可能性 | Condition: compact extracted fields by removing null/empty values. Expected: behavior/state/result is correct (Integration). |
| 36 | Integration | セキュリティ | `apps/v2-modern/tests/integration/metrics.route.test.ts:16` | Metrics Route | 許可されたイベントを受理する | 不正アクセス許容・本番遮断不備につながる可能性 | 条件: 許可されたイベントを受理する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 37 | Integration | セキュリティ | `apps/v2-modern/tests/integration/metrics.route.test.ts:34` | Metrics Route | 未定義イベントを拒否する | 不正アクセス許容・本番遮断不備につながる可能性 | 条件: 未定義イベントを拒否する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 38 | Integration | セキュリティ | `apps/v2-modern/tests/integration/security.middleware.test.ts:41` | security middleware integration | 本番設定でAPI_TOKEN未設定なら503を返す | 不正アクセス許容・本番遮断不備につながる可能性 | 条件: 本番設定でAPI_TOKEN未設定なら503を返す。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 39 | Integration | セキュリティ | `apps/v2-modern/tests/integration/security.middleware.test.ts:55` | security middleware integration | API_TOKEN設定時にAuthorizationなしなら401を返す | 不正アクセス許容・本番遮断不備につながる可能性 | 条件: API_TOKEN設定時にAuthorizationなしなら401を返す。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 40 | Integration | セキュリティ | `apps/v2-modern/tests/integration/security.middleware.test.ts:67` | security middleware integration | REQUIRE_API_TOKEN=0 ならAPI_TOKEN設定済みでもAuthorizationなしで通る | 不正アクセス許容・本番遮断不備につながる可能性 | 条件: REQUIRE_API_TOKEN=0 ならAPI_TOKEN設定済みでもAuthorizationなしで通る。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 41 | Integration | セキュリティ | `apps/v2-modern/tests/integration/security.middleware.test.ts:79` | security middleware integration | 認証任意モードではAuthorizationが付与されていても検証せず通る | 不正アクセス許容・本番遮断不備につながる可能性 | 条件: 認証任意モードではAuthorizationが付与されていても検証せず通る。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 42 | Integration | セキュリティ | `apps/v2-modern/tests/integration/security.middleware.test.ts:98` | security middleware integration | STRICT_CORS有効時に未許可Originは403になる | 不正アクセス許容・本番遮断不備につながる可能性 | 条件: STRICT_CORS有効時に未許可Originは403になる。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 43 | Integration | セキュリティ | `apps/v2-modern/tests/integration/security.middleware.test.ts:119` | security middleware integration | 許可Origin + 正しいAuthorizationなら200になる | 不正アクセス許容・本番遮断不備につながる可能性 | 条件: 許可Origin + 正しいAuthorizationなら200になる。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 44 | Integration | セキュリティ | `apps/v2-modern/tests/integration/security.middleware.test.ts:141` | security middleware integration | STRICT_CORS有効でもPages固定デプロイURL（hash）Originは許可される | 不正アクセス許容・本番遮断不備につながる可能性 | 条件: STRICT_CORS有効でもPages固定デプロイURL（hash）Originは許可される。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 45 | Integration | セキュリティ | `apps/v2-modern/tests/integration/security.middleware.test.ts:162` | security middleware integration | dev wildcard無効時は workers.dev Origin を拒否する | 不正アクセス許容・本番遮断不備につながる可能性 | 条件: dev wildcard無効時は workers.dev Origin を拒否する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 46 | Integration | セキュリティ | `apps/v2-modern/tests/integration/security.middleware.test.ts:183` | security middleware integration | ALLOW_DEV_ORIGIN_WILDCARDS=1 のとき workers.dev Origin を許可する | 不正アクセス許容・本番遮断不備につながる可能性 | 条件: ALLOW_DEV_ORIGIN_WILDCARDS=1 のとき workers.dev Origin を許可する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 47 | Integration | セキュリティ | `apps/v2-modern/tests/integration/security.middleware.test.ts:205` | security middleware integration | healthは設定不備時にdegradedを返す | 不正アクセス許容・本番遮断不備につながる可能性 | 条件: healthは設定不備時にdegradedを返す。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 48 | Integration | セキュリティ | `apps/v2-modern/tests/integration/sentry.debug-endpoints.test.ts:42` | Sentry debug endpoints | ENABLE_SENTRY_TEST_ENDPOINT 未設定時は 404 を返す | 仕様回帰の見逃しにつながる可能性 | 条件: ENABLE_SENTRY_TEST_ENDPOINT 未設定時は 404 を返す。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 49 | Integration | セキュリティ | `apps/v2-modern/tests/integration/sentry.debug-endpoints.test.ts:52` | Sentry debug endpoints | 有効化時はバックエンド例外を意図的に発生させ、500 を返す | 仕様回帰の見逃しにつながる可能性 | 条件: 有効化時はバックエンド例外を意図的に発生させ、500 を返す。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 50 | Integration | セキュリティ | `apps/v2-modern/tests/integration/sentry.debug-endpoints.test.ts:64` | Sentry debug endpoints | SENTRY_TEST_TOKEN 設定時は x-sentry-test-token が必須になる | 不正アクセス許容・本番遮断不備につながる可能性 | 条件: SENTRY_TEST_TOKEN 設定時は x-sentry-test-token が必須になる。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 51 | Integration | セキュリティ | `apps/v2-modern/tests/integration/sentry.debug-endpoints.test.ts:90` | Sentry debug endpoints | trace endpoint は sentry-trace / baggage をエコーする | 仕様回帰の見逃しにつながる可能性 | 条件: trace endpoint は sentry-trace / baggage をエコーする。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 52 | Integration | セキュリティ | `apps/v2-modern/tests/integration/sentry.debug-endpoints.test.ts:111` | Sentry debug endpoints | CORS preflight で sentry 関連ヘッダが許可される | 不正アクセス許容・本番遮断不備につながる可能性 | 条件: CORS preflight で sentry 関連ヘッダが許可される。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 53 | Unit | 機能整合 | `apps/v2-modern/tests/unit/aiProvider.test.ts:10` | aiProvider helpers | AI_PROVIDER が gemini の場合は gemini を返し、それ以外は openai を返す | 仕様回帰の見逃しにつながる可能性 | 条件: AI_PROVIDER が gemini の場合は gemini を返し、それ以外は openai を返す。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 54 | Unit | 機能整合 | `apps/v2-modern/tests/unit/aiProvider.test.ts:18` | aiProvider helpers | provider に応じた API キーを返す | 仕様回帰の見逃しにつながる可能性 | 条件: provider に応じた API キーを返す。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 55 | Unit | 機能整合 | `apps/v2-modern/tests/unit/aiProvider.test.ts:28` | aiProvider helpers | AI_MODEL がある場合は provider に関係なく優先する | 仕様回帰の見逃しにつながる可能性 | 条件: AI_MODEL がある場合は provider に関係なく優先する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 56 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/aiProvider.test.ts:38` | aiProvider helpers | AI_MODEL 未設定時は provider 別のモデル設定と既定値へフォールバックする | 仕様回帰の見逃しにつながる可能性 | 条件: AI_MODEL 未設定時は provider 別のモデル設定と既定値へフォールバックする。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 57 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/api.chatError.test.ts:14` | postChat error classification | ネットワーク失敗を network として分類する | 本番で会話停止・失敗率増加につながる可能性 | 条件: ネットワーク失敗を network として分類する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 58 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/api.chatError.test.ts:29` | postChat error classification | 429エラーを rate_limit として分類し Retry-After を保持する | 本番で会話停止・失敗率増加につながる可能性 | 条件: 429エラーを rate_limit として分類し Retry-After を保持する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 59 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/api.feedbackError.test.ts:25` | postFeedback error classification | ネットワーク失敗を network として分類する | 本番で会話停止・失敗率増加につながる可能性 | 条件: ネットワーク失敗を network として分類する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 60 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/api.feedbackError.test.ts:40` | postFeedback error classification | AbortErrorはそのまま再スローする | 本番で会話停止・失敗率増加につながる可能性 | 条件: AbortErrorはそのまま再スローする。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 61 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/api.feedbackError.test.ts:50` | postFeedback error classification | 429エラーを rate_limit として分類し Retry-After を保持する | 本番で会話停止・失敗率増加につながる可能性 | 条件: 429エラーを rate_limit として分類し Retry-After を保持する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 62 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/api.feedbackError.test.ts:74` | postFeedback error classification | 5xxエラーを server として分類し retriable を true にする | 本番で会話停止・失敗率増加につながる可能性 | 条件: 5xxエラーを server として分類し retriable を true にする。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 63 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/api.feedbackError.test.ts:96` | postFeedback error classification | 204レスポンスは null を返す | 本番で会話停止・失敗率増加につながる可能性 | 条件: 204レスポンスは null を返す。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 64 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/apiBase.test.ts:5` | normalizeApiBaseFromEnv | 未指定は /api にフォールバックする | 仕様回帰の見逃しにつながる可能性 | 条件: 未指定は /api にフォールバックする。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 65 | Unit | 機能整合 | `apps/v2-modern/tests/unit/apiBase.test.ts:12` | normalizeApiBaseFromEnv | 絶対URLは /api を補完する | 仕様回帰の見逃しにつながる可能性 | 条件: 絶対URLは /api を補完する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 66 | Unit | 機能整合 | `apps/v2-modern/tests/unit/apiBase.test.ts:19` | normalizeApiBaseFromEnv | 絶対URLで既に /api がある場合は維持する | 仕様回帰の見逃しにつながる可能性 | 条件: 絶対URLで既に /api がある場合は維持する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 67 | Unit | 機能整合 | `apps/v2-modern/tests/unit/apiBase.test.ts:25` | normalizeApiBaseFromEnv | 相対パスはそのまま返す（末尾スラッシュは除去） | 仕様回帰の見逃しにつながる可能性 | 条件: 相対パスはそのまま返す（末尾スラッシュは除去）。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 68 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/apiBase.test.ts:31` | normalizeApiBaseFromEnv | fallbackBase を指定できる | 本番で会話停止・失敗率増加につながる可能性 | 条件: fallbackBase を指定できる。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 69 | Unit | 機能整合 | `apps/v2-modern/tests/unit/apiBase.test.ts:39` | resolveRuntimeApiBase | https配信 + localhost API指定時は productionApiBase に補正する | 仕様回帰の見逃しにつながる可能性 | 条件: https配信 + localhost API指定時は productionApiBase に補正する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 70 | Unit | 機能整合 | `apps/v2-modern/tests/unit/apiBase.test.ts:49` | resolveRuntimeApiBase | ローカル開発（localhost配信）では localhost API を維持する | 仕様回帰の見逃しにつながる可能性 | 条件: ローカル開発（localhost配信）では localhost API を維持する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 71 | Unit | 機能整合 | `apps/v2-modern/tests/unit/chat.requestPayload.test.ts:5` | buildRequestMessages | user/assistant 以外の role を除外する | 仕様回帰の見逃しにつながる可能性 | 条件: user/assistant 以外の role を除外する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 72 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/chat.requestPayload.test.ts:27` | buildRequestMessages | リトライ時は末尾のエラーメッセージを除外し、ユーザー入力の重複を避ける | 本番で会話停止・失敗率増加につながる可能性 | 条件: リトライ時は末尾のエラーメッセージを除外し、ユーザー入力の重複を避ける。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 73 | Unit | 機能整合 | `apps/v2-modern/tests/unit/chat.requestPayload.test.ts:43` | buildRequestMessages | 履歴は MAX_CLIENT_HISTORY_MESSAGES に制限する | 仕様回帰の見逃しにつながる可能性 | 条件: 履歴は MAX_CLIENT_HISTORY_MESSAGES に制限する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 74 | Unit | UI/UX | `apps/v2-modern/tests/unit/chatBubble.autoSpeak.test.tsx:24` | ChatBubble auto speak | 完全音声会話モード時にAIメッセージを自動読み上げする（1回のみ） | ユーザー操作不能・UI回帰につながる可能性 | 条件: 完全音声会話モード時にAIメッセージを自動読み上げする（1回のみ）。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 75 | Unit | 機能整合 | `apps/v2-modern/tests/unit/chatBubble.autoSpeak.test.tsx:39` | ChatBubble auto speak | ユーザーメッセージでは自動読み上げしない | 仕様回帰の見逃しにつながる可能性 | 条件: ユーザーメッセージでは自動読み上げしない。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 76 | Unit | UI/UX | `apps/v2-modern/tests/unit/chatInput.fullVoiceMode.test.tsx:27` | ChatInput full voice mode | 完全音声会話モードでは最終認識結果を自動送信する | ユーザー操作不能・UI回帰につながる可能性 | 条件: 完全音声会話モードでは最終認識結果を自動送信する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 77 | Unit | UI/UX | `apps/v2-modern/tests/unit/chatInput.fullVoiceMode.test.tsx:37` | ChatInput full voice mode | 同一文言の連続確定は短時間で重複送信しない | ユーザー操作不能・UI回帰につながる可能性 | 条件: 同一文言の連続確定は短時間で重複送信しない。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 78 | Unit | UI/UX | `apps/v2-modern/tests/unit/chatInput.fullVoiceMode.test.tsx:47` | ChatInput full voice mode | 通常モードでは最終認識結果を自動送信しない | ユーザー操作不能・UI回帰につながる可能性 | 条件: 通常モードでは最終認識結果を自動送信しない。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 79 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/chatInput.micError.test.tsx:17` | ChatInput mic error | マイクエラーを入力欄の上段メッセージ領域に表示する | 本番で会話停止・失敗率増加につながる可能性 | 条件: マイクエラーを入力欄の上段メッセージ領域に表示する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 80 | Unit | UI/UX | `apps/v2-modern/tests/unit/completionPage.test.tsx:36` | CompletionPage | 未完了セッションでは完了化せず /session へ戻す | ユーザー操作不能・UI回帰につながる可能性 | 条件: 未完了セッションでは完了化せず /session へ戻す。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 81 | Unit | 機能整合 | `apps/v2-modern/tests/unit/contextInjection.test.ts:37` | Context Injection | should inject weather context | 仕様回帰の見逃しにつながる可能性 | Condition: inject weather context. Expected: behavior/state/result is correct (Unit). |
| 82 | Unit | 機能整合 | `apps/v2-modern/tests/unit/contextInjection.test.ts:49` | Context Injection | should inject recent risks warning | 仕様回帰の見逃しにつながる可能性 | Condition: inject recent risks warning. Expected: behavior/state/result is correct (Unit). |
| 83 | Unit | 機能整合 | `apps/v2-modern/tests/unit/contextInjection.test.ts:63` | Context Injection | should inject past hiyari hatto | 仕様回帰の見逃しにつながる可能性 | Condition: inject past hiyari hatto. Expected: behavior/state/result is correct (Unit). |
| 84 | Unit | 機能整合 | `apps/v2-modern/tests/unit/envFlags.test.ts:5` | envFlags | parseBooleanFlag が true/false の代表値を解釈できる | 仕様回帰の見逃しにつながる可能性 | 条件: parseBooleanFlag が true/false の代表値を解釈できる。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 85 | Unit | 機能整合 | `apps/v2-modern/tests/unit/envFlags.test.ts:17` | envFlags | parseBooleanFlag は未知値を null にする | 仕様回帰の見逃しにつながる可能性 | 条件: parseBooleanFlag は未知値を null にする。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 86 | Unit | 機能整合 | `apps/v2-modern/tests/unit/envFlags.test.ts:24` | envFlags | resolveBooleanFlag は未知値のとき既定値を返す | 仕様回帰の見逃しにつながる可能性 | 条件: resolveBooleanFlag は未知値のとき既定値を返す。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 87 | Unit | 機能整合 | `apps/v2-modern/tests/unit/greeting.test.ts:5` | getTimeGreeting | should return おはようございます！ between 05-11 | 仕様回帰の見逃しにつながる可能性 | 条件: should return おはようございます！ between 05-11。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 88 | Unit | 機能整合 | `apps/v2-modern/tests/unit/greeting.test.ts:10` | getTimeGreeting | should return こんにちは！ between 12-17 | 仕様回帰の見逃しにつながる可能性 | 条件: should return こんにちは！ between 12-17。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 89 | Unit | 機能整合 | `apps/v2-modern/tests/unit/greeting.test.ts:15` | getTimeGreeting | should return こんばんは！ between 18-04 | 仕様回帰の見逃しにつながる可能性 | 条件: should return こんばんは！ between 18-04。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 90 | Unit | 機能整合 | `apps/v2-modern/tests/unit/historyUtils.test.ts:48` | Risk Filtering | should filter past risks by similarity | 仕様回帰の見逃しにつながる可能性 | Condition: filter past risks by similarity. Expected: behavior/state/result is correct (Unit). |
| 91 | Unit | UI/UX | `apps/v2-modern/tests/unit/historyUtils.test.ts:66` | Risk Filtering | should exclude current session ID | 仕様回帰の見逃しにつながる可能性 | Condition: exclude current session ID. Expected: behavior/state/result is correct (Unit). |
| 92 | Unit | 機能整合 | `apps/v2-modern/tests/unit/historyUtils.test.ts:75` | Retention Policy | should enforce retention policy (max items) | 仕様回帰の見逃しにつながる可能性 | Condition: enforce retention policy (max items). Expected: behavior/state/result is correct (Unit). |
| 93 | Unit | 機能整合 | `apps/v2-modern/tests/unit/historyUtils.test.ts:107` | Recent Risks | should retrieve risks within specified days | 仕様回帰の見逃しにつながる可能性 | Condition: retrieve risks within specified days. Expected: behavior/state/result is correct (Unit). |
| 94 | Unit | 機能整合 | `apps/v2-modern/tests/unit/historyUtils.test.ts:126` | Hiyari Hatto | should retrieve hiyari hatto items | 仕様回帰の見逃しにつながる可能性 | Condition: retrieve hiyari hatto items. Expected: behavior/state/result is correct (Unit). |
| 95 | Unit | セキュリティ | `apps/v2-modern/tests/unit/homePage.apiTokenSettings.test.tsx:36` | HomePage API token settings | 通常環境では新規開始フォームにAPIトークン入力を表示しない | 不正アクセス許容・本番遮断不備につながる可能性 | 条件: 通常環境では新規開始フォームにAPIトークン入力を表示しない。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 96 | Unit | セキュリティ | `apps/v2-modern/tests/unit/homePage.apiTokenSettings.test.tsx:42` | HomePage API token settings | 通常環境では進行中セッション画面にもAPIトークン入力を表示しない | 不正アクセス許容・本番遮断不備につながる可能性 | 条件: 通常環境では進行中セッション画面にもAPIトークン入力を表示しない。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 97 | Unit | セキュリティ | `apps/v2-modern/tests/unit/homePage.apiTokenSettings.test.tsx:51` | HomePage API token settings | 必須環境（true/yes/1）ではAPIトークン入力を表示する | 不正アクセス許容・本番遮断不備につながる可能性 | 条件: 必須環境（true/yes/1）ではAPIトークン入力を表示する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 98 | Unit | セキュリティ | `apps/v2-modern/tests/unit/homePage.apiTokenSettings.test.tsx:59` | HomePage API token settings | 必須環境（yes）でもAPIトークン入力を表示する | 不正アクセス許容・本番遮断不備につながる可能性 | 条件: 必須環境（yes）でもAPIトークン入力を表示する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 99 | Unit | UI/UX | `apps/v2-modern/tests/unit/homePage.focusStylePreview.test.tsx:36` | HomePage focus style preview | A案本番採用後は比較モデルをHome画面に表示しない | ユーザー操作不能・UI回帰につながる可能性 | 条件: A案本番採用後は比較モデルをHome画面に表示しない。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 100 | Unit | UI/UX | `apps/v2-modern/tests/unit/homePage.sessionEntryNavigation.test.tsx:30` | HomePage session entry navigation | 新規開始時は entry=new を付与して session へ遷移する | ユーザー操作不能・UI回帰につながる可能性 | 条件: 新規開始時は entry=new を付与して session へ遷移する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 101 | Unit | UI/UX | `apps/v2-modern/tests/unit/homePage.sessionEntryNavigation.test.tsx:40` | HomePage session entry navigation | 再開時は entry=resume を付与して session へ遷移する | ユーザー操作不能・UI回帰につながる可能性 | 条件: 再開時は entry=resume を付与して session へ遷移する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 102 | Unit | UI/UX | `apps/v2-modern/tests/unit/kyBoardCard.test.tsx:18` | KYBoardCard | 1件目で未入力時は理想的なKYのプレースホルダーを表示する | ユーザー操作不能・UI回帰につながる可能性 | 条件: 1件目で未入力時は理想的なKYのプレースホルダーを表示する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 103 | Unit | UI/UX | `apps/v2-modern/tests/unit/kyBoardCard.test.tsx:26` | KYBoardCard | 1件目でも入力済みの欄ではプレースホルダーを表示しない | ユーザー操作不能・UI回帰につながる可能性 | 条件: 1件目でも入力済みの欄ではプレースホルダーを表示しない。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 104 | Unit | UI/UX | `apps/v2-modern/tests/unit/kyBoardCard.test.tsx:38` | KYBoardCard | 2件目では未入力でもプレースホルダーを表示しない | ユーザー操作不能・UI回帰につながる可能性 | 条件: 2件目では未入力でもプレースホルダーを表示しない。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 105 | Unit | UI/UX | `apps/v2-modern/tests/unit/kyBoardCard.test.tsx:46` | KYBoardCard | 未入力時は具体性/詳細度バーを灰色の未評価表示にする | ユーザー操作不能・UI回帰につながる可能性 | 条件: 未入力時は具体性/詳細度バーを灰色の未評価表示にする。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 106 | Unit | 機能整合 | `apps/v2-modern/tests/unit/kyBoardCard.test.tsx:55` | KYBoardCard | 具体性バーは何をする時の文字数で小中大に変化する | 仕様回帰の見逃しにつながる可能性 | 条件: 具体性バーは何をする時の文字数で小中大に変化する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 107 | Unit | 機能整合 | `apps/v2-modern/tests/unit/kyBoardCard.test.tsx:94` | KYBoardCard | 詳細度バーは何が原因での文字数で小中大に変化する | 仕様回帰の見逃しにつながる可能性 | 条件: 詳細度バーは何が原因での文字数で小中大に変化する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 108 | Unit | 機能整合 | `apps/v2-modern/tests/unit/kyBoardCard.test.tsx:133` | KYBoardCard | 未入力時のバー長は短縮した未評価サイズを使う | 仕様回帰の見逃しにつながる可能性 | 条件: 未入力時のバー長は短縮した未評価サイズを使う。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 109 | Unit | UI/UX | `apps/v2-modern/tests/unit/kyBoardCard.test.tsx:140` | KYBoardCard | セグメントバーとチェックを左列に表示する | ユーザー操作不能・UI回帰につながる可能性 | 条件: セグメントバーとチェックを左列に表示する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 110 | Unit | UI/UX | `apps/v2-modern/tests/unit/kyBoardCard.test.tsx:156` | KYBoardCard | 小中大のラベルをバーの左側に表示する | ユーザー操作不能・UI回帰につながる可能性 | 条件: 小中大のラベルをバーの左側に表示する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 111 | Unit | UI/UX | `apps/v2-modern/tests/unit/kyBoardCard.test.tsx:175` | KYBoardCard | どうなるに入力がある時のみ右下に丸付きチェックを表示する | ユーザー操作不能・UI回帰につながる可能性 | 条件: どうなるに入力がある時のみ右下に丸付きチェックを表示する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 112 | Unit | 機能整合 | `apps/v2-modern/tests/unit/kyBoardCard.test.tsx:197` | KYBoardCard | サイズ指定に応じてdata-scale属性を切り替える | 仕様回帰の見逃しにつながる可能性 | 条件: サイズ指定に応じてdata-scale属性を切り替える。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 113 | Unit | UI/UX | `apps/v2-modern/tests/unit/kyBoardCard.test.tsx:212` | KYBoardCard | 初期表示では想定される危険の4行のみを表示し、対策表は表示しない | ユーザー操作不能・UI回帰につながる可能性 | 条件: 初期表示では想定される危険の4行のみを表示し、対策表は表示しない。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 114 | Unit | UI/UX | `apps/v2-modern/tests/unit/kyBoardCard.test.tsx:227` | KYBoardCard | 危険情報4項目が揃うと対策表を表示し、配置・行動ラベルを使う | ユーザー操作不能・UI回帰につながる可能性 | 条件: 危険情報4項目が揃うと対策表を表示し、配置・行動ラベルを使う。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 115 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/kySchemas.extracted.test.ts:5` | ExtractedDataSchema (coercion/normalization) | should coerce legacy shapes (string arrays, string riskLevel, string whyDangerous) | 本番で会話停止・失敗率増加につながる可能性 | Condition: coerce legacy shapes (string arrays, string riskLevel, string whyDangerous). Expected: behavior/state/result is correct (Unit). |
| 116 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/kySchemas.workItem.test.ts:13` | WorkItemSchema | should reject when countermeasures has only 1 item | 本番で会話停止・失敗率増加につながる可能性 | Condition: reject when countermeasures has only 1 item. Expected: behavior/state/result is correct (Unit). |
| 117 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/kySchemas.workItem.test.ts:21` | WorkItemSchema | should accept when countermeasures has 2 items | 本番で会話停止・失敗率増加につながる可能性 | Condition: accept when countermeasures has 2 items. Expected: behavior/state/result is correct (Unit). |
| 118 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/kySchemas.workItem.test.ts:32` | WorkItemSchema | should reject when whyDangerous has 4 items (max 3) | 本番で会話停止・失敗率増加につながる可能性 | Condition: reject when whyDangerous has 4 items (max 3). Expected: behavior/state/result is correct (Unit). |
| 119 | Unit | 機能整合 | `apps/v2-modern/tests/unit/kySchemas.workItem.test.ts:46` | normalizeCountermeasuresInput | should normalize legacy string[] into behavior measures | 仕様回帰の見逃しにつながる可能性 | Condition: normalize legacy string[] into behavior measures. Expected: behavior/state/result is correct (Unit). |
| 120 | Unit | 機能整合 | `apps/v2-modern/tests/unit/kySchemas.workItem.test.ts:54` | normalizeCountermeasuresInput | should dedupe case-insensitively and keep first occurrence | 仕様回帰の見逃しにつながる可能性 | Condition: dedupe case-insensitively and keep first occurrence. Expected: behavior/state/result is correct (Unit). |
| 121 | Unit | UI/UX | `apps/v2-modern/tests/unit/kySessionPage.firstWorkItemFlow.test.tsx:54` | KYSessionPage first work item flow | 1件目で対策2件が揃うと「1件目完了」ボタンを表示する | ユーザー操作不能・UI回帰につながる可能性 | 条件: 1件目で対策2件が揃うと「1件目完了」ボタンを表示する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 122 | Unit | UI/UX | `apps/v2-modern/tests/unit/kySessionPage.firstWorkItemFlow.test.tsx:72` | KYSessionPage first work item flow | 進捗バーに参考情報ボタンを表示し、国交省PDFリンクを設定する | ユーザー操作不能・UI回帰につながる可能性 | 条件: 進捗バーに参考情報ボタンを表示し、国交省PDFリンクを設定する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 123 | Unit | UI/UX | `apps/v2-modern/tests/unit/kySessionPage.firstWorkItemFlow.test.tsx:82` | KYSessionPage first work item flow | 会話モード切替を参考情報帯に配置し、旧進捗ラベルを表示しない | ユーザー操作不能・UI回帰につながる可能性 | 条件: 会話モード切替を参考情報帯に配置し、旧進捗ラベルを表示しない。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 124 | Unit | UI/UX | `apps/v2-modern/tests/unit/kySessionPage.firstWorkItemFlow.test.tsx:93` | KYSessionPage first work item flow | 1件目で対策3件が揃ったら入力欄を隠し、完了ボタンのみ表示する | ユーザー操作不能・UI回帰につながる可能性 | 条件: 1件目で対策3件が揃ったら入力欄を隠し、完了ボタンのみ表示する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 125 | Unit | UI/UX | `apps/v2-modern/tests/unit/kySessionPage.firstWorkItemFlow.test.tsx:112` | KYSessionPage first work item flow | 2件目で対策2件が揃うと「2件目完了」ボタンを表示して押下できる | ユーザー操作不能・UI回帰につながる可能性 | 条件: 2件目で対策2件が揃うと「2件目完了」ボタンを表示して押下できる。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 126 | Unit | UI/UX | `apps/v2-modern/tests/unit/kySessionPage.firstWorkItemFlow.test.tsx:145` | KYSessionPage first work item flow | KYボードのサイズ切替は拡大を初期値にし、縮小/拡大を切り替えできる | ユーザー操作不能・UI回帰につながる可能性 | 条件: KYボードのサイズ切替は拡大を初期値にし、縮小/拡大を切り替えできる。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 127 | Unit | UI/UX | `apps/v2-modern/tests/unit/kySessionPage.firstWorkItemFlow.test.tsx:163` | KYSessionPage first work item flow | confirmation時は4項目チェックが揃うまで完了ボタンを無効化し、揃うと完了処理を呼ぶ | ユーザー操作不能・UI回帰につながる可能性 | 条件: confirmation時は4項目チェックが揃うまで完了ボタンを無効化し、揃うと完了処理を呼ぶ。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 128 | Unit | UI/UX | `apps/v2-modern/tests/unit/kySessionPage.voiceBoot.test.tsx:95` | KYSessionPage initial voice boot | 再開かつ完全音声会話モードでは、初回ガイド音声を再生しマイク自動開始を待機する | ユーザー操作不能・UI回帰につながる可能性 | 条件: 再開かつ完全音声会話モードでは、初回ガイド音声を再生しマイク自動開始を待機する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 129 | Unit | UI/UX | `apps/v2-modern/tests/unit/kySessionPage.voiceBoot.test.tsx:109` | KYSessionPage initial voice boot | 開始導線情報が無い場合は、初回ガイド音声を再生しない | ユーザー操作不能・UI回帰につながる可能性 | 条件: 開始導線情報が無い場合は、初回ガイド音声を再生しない。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 130 | Unit | UI/UX | `apps/v2-modern/tests/unit/kySessionPage.voiceBoot.test.tsx:117` | KYSessionPage initial voice boot | 再開かつメッセージ0件でも、初回ガイド音声を再生する | ユーザー操作不能・UI回帰につながる可能性 | 条件: 再開かつメッセージ0件でも、初回ガイド音声を再生する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 131 | Unit | UI/UX | `apps/v2-modern/tests/unit/kySessionPage.voiceBoot.test.tsx:129` | KYSessionPage initial voice boot | 初期ブート待機中は、既存AIメッセージの autoSpeak を抑止する | ユーザー操作不能・UI回帰につながる可能性 | 条件: 初期ブート待機中は、既存AIメッセージの autoSpeak を抑止する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 132 | Unit | セキュリティ | `apps/v2-modern/tests/unit/kySessionPage.voiceBoot.test.tsx:142` | KYSessionPage initial voice boot | 初回ガイド音声が not-allowed で失敗した場合は待機を解除してマイク自動開始を許可する | 不正アクセス許容・本番遮断不備につながる可能性 | 条件: 初回ガイド音声が not-allowed で失敗した場合は待機を解除してマイク自動開始を許可する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 133 | Unit | UI/UX | `apps/v2-modern/tests/unit/kyStore.test.ts:11` | kyStore | starts a new session correctly | 仕様回帰の見逃しにつながる可能性 | Condition: starts a new session correctly. Expected: behavior/state/result is correct (Unit). |
| 134 | Unit | 機能整合 | `apps/v2-modern/tests/unit/kyStore.test.ts:24` | kyStore | adds messages correctly | 仕様回帰の見逃しにつながる可能性 | Condition: adds messages correctly. Expected: behavior/state/result is correct (Unit). |
| 135 | Unit | 機能整合 | `apps/v2-modern/tests/unit/kyStore.test.ts:39` | kyStore | updates current work item | 仕様回帰の見逃しにつながる可能性 | Condition: updates current work item. Expected: behavior/state/result is correct (Unit). |
| 136 | Unit | 機能整合 | `apps/v2-modern/tests/unit/kyStore.test.ts:49` | kyStore | commits a valid work item | 仕様回帰の見逃しにつながる可能性 | Condition: commits a valid work item. Expected: behavior/state/result is correct (Unit). |
| 137 | Unit | UI/UX | `apps/v2-modern/tests/unit/kyStore.test.ts:81` | kyStore | completes the session | 仕様回帰の見逃しにつながる可能性 | Condition: completes the session. Expected: behavior/state/result is correct (Unit). |
| 138 | Unit | 機能整合 | `apps/v2-modern/tests/unit/kyStore.test.ts:97` | kyStore | updates action goal via updateActionGoal | 仕様回帰の見逃しにつながる可能性 | Condition: updates action goal via updateActionGoal. Expected: behavior/state/result is correct (Unit). |
| 139 | Unit | 機能整合 | `apps/v2-modern/tests/unit/kyStore.test.ts:105` | kyStore | limits work items to 2 and forces action_goal after the second commit | 仕様回帰の見逃しにつながる可能性 | Condition: limits work items to 2 and forces action_goal after the second commit. Expected: behavior/state/result is correct (Unit). |
| 140 | Unit | 機能整合 | `apps/v2-modern/tests/unit/logger.test.ts:9` | logger masking | PIIと秘密情報をマスクする | 仕様回帰の見逃しにつながる可能性 | 条件: PIIと秘密情報をマスクする。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 141 | Unit | 機能整合 | `apps/v2-modern/tests/unit/logger.test.ts:27` | logger masking | logInfo出力でもマスクされた値が使われる | 仕様回帰の見逃しにつながる可能性 | 条件: logInfo出力でもマスクされた値が使われる。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 142 | Unit | 機能整合 | `apps/v2-modern/tests/unit/mergeExtractedData.test.ts:5` | mergeExtractedData | whyDangerous が欠落していても推論補完しない | 仕様回帰の見逃しにつながる可能性 | 条件: whyDangerous が欠落していても推論補完しない。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 143 | Unit | 機能整合 | `apps/v2-modern/tests/unit/mergeExtractedData.test.ts:25` | mergeExtractedData | 既存の whyDangerous がある場合は推論補完を追加しない | 仕様回帰の見逃しにつながる可能性 | 条件: 既存の whyDangerous がある場合は推論補完を追加しない。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 144 | Unit | 観測性/性能 | `apps/v2-modern/tests/unit/metrics.test.ts:5` | KPI & Metrics Logic | 会話ターン数を user 発言ベースで算出する | 劣化検知遅延・運用判断ミスにつながる可能性 | 条件: 会話ターン数を user 発言ベースで算出する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 145 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/metrics.test.ts:17` | KPI & Metrics Logic | chat_error / retry_failed が連続するとエラーループと判定する | 本番で会話停止・失敗率増加につながる可能性 | 条件: chat_error / retry_failed が連続するとエラーループと判定する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 146 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/metrics.test.ts:28` | KPI & Metrics Logic | retry_succeeded で連続エラーをリセットする | 本番で会話停止・失敗率増加につながる可能性 | 条件: retry_succeeded で連続エラーをリセットする。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 147 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/micButton.errorClear.test.tsx:30` | MicButton error UX | 入力欄に1文字入ったら音声エラー表示をクリアする | 本番で会話停止・失敗率増加につながる可能性 | 条件: 入力欄に1文字入ったら音声エラー表示をクリアする。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 148 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/micButton.errorClear.test.tsx:46` | MicButton error UX | 音声エラーを親コンポーネントへ通知する | 本番で会話停止・失敗率増加につながる可能性 | 条件: 音声エラーを親コンポーネントへ通知する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 149 | Unit | UI/UX | `apps/v2-modern/tests/unit/micButton.fullVoiceMode.test.tsx:40` | MicButton full voice mode | 完全音声会話モードでは自動開始し、自動再開を有効化する | ユーザー操作不能・UI回帰につながる可能性 | 条件: 完全音声会話モードでは自動開始し、自動再開を有効化する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 150 | Unit | UI/UX | `apps/v2-modern/tests/unit/micButton.fullVoiceMode.test.tsx:57` | MicButton full voice mode | 通常モードでは自動再開を無効化し、自動開始しない | ユーザー操作不能・UI回帰につながる可能性 | 条件: 通常モードでは自動再開を無効化し、自動開始しない。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 151 | Unit | UI/UX | `apps/v2-modern/tests/unit/micButton.fullVoiceMode.test.tsx:71` | MicButton full voice mode | 自動開始ゲートが無効なら、完全音声会話モードでも自動開始しない | ユーザー操作不能・UI回帰につながる可能性 | 条件: 自動開始ゲートが無効なら、完全音声会話モードでも自動開始しない。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 152 | Unit | UI/UX | `apps/v2-modern/tests/unit/micButton.fullVoiceMode.test.tsx:86` | MicButton full voice mode | 強制停止解除と自動開始が同時条件でも start は1回のみ | ユーザー操作不能・UI回帰につながる可能性 | 条件: 強制停止解除と自動開始が同時条件でも start は1回のみ。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 153 | Unit | UI/UX | `apps/v2-modern/tests/unit/micButton.fullVoiceMode.test.tsx:123` | MicButton full voice mode | 完全音声会話モードで手動開始した場合、autoRestart を再有効化して開始する | ユーザー操作不能・UI回帰につながる可能性 | 条件: 完全音声会話モードで手動開始した場合、autoRestart を再有効化して開始する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 154 | Unit | UI/UX | `apps/v2-modern/tests/unit/micButton.transcriptFlow.test.tsx:32` | MicButton transcript flow | 完全音声会話モードでは中間結果も入力欄へ反映する | ユーザー操作不能・UI回帰につながる可能性 | 条件: 完全音声会話モードでは中間結果も入力欄へ反映する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 155 | Unit | UI/UX | `apps/v2-modern/tests/unit/micButton.transcriptFlow.test.tsx:60` | MicButton transcript flow | 通常モードでは確定結果のみ反映する | ユーザー操作不能・UI回帰につながる可能性 | 条件: 通常モードでは確定結果のみ反映する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 156 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/openaiHttpError.test.ts:15` | fetchOpenAICompletion - OpenAI HTTP errors | throws OpenAIHTTPErrorWithDetails with upstream message on 400 | 本番で会話停止・失敗率増加につながる可能性 | Condition: throws OpenAIHTTPErrorWithDetails with upstream message on 400. Expected: behavior/state/result is correct (Unit). |
| 157 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/openaiHttpError.test.ts:45` | fetchOpenAICompletion - OpenAI HTTP errors | passes through retry-after on 429 | 本番で会話停止・失敗率増加につながる可能性 | Condition: passes through retry-after on 429. Expected: behavior/state/result is correct (Unit). |
| 158 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/openaiHttpError.test.ts:70` | fetchOpenAICompletion - OpenAI HTTP errors | supports Gemini via OpenAI-compatible endpoint when provider=gemini | 本番で会話停止・失敗率増加につながる可能性 | Condition: supports Gemini via OpenAI-compatible endpoint when provider=gemini. Expected: behavior/state/result is correct (Unit). |
| 159 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/openaiJsonCleanup.test.ts:5` | openai json cleanup | extracts JSON from fenced code blocks | 本番で会話停止・失敗率増加につながる可能性 | Condition: extracts JSON from fenced code blocks. Expected: behavior/state/result is correct (Unit). |
| 160 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/openaiJsonCleanup.test.ts:10` | openai json cleanup | extracts JSON from embedded fenced blocks with prose | 本番で会話停止・失敗率増加につながる可能性 | Condition: extracts JSON from embedded fenced blocks with prose. Expected: behavior/state/result is correct (Unit). |
| 161 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/openaiJsonCleanup.test.ts:15` | openai json cleanup | safeParseJSON handles BOM + fenced JSON | 本番で会話停止・失敗率増加につながる可能性 | Condition: safeParseJSON handles BOM + fenced JSON. Expected: behavior/state/result is correct (Unit). |
| 162 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/rateLimit.test.ts:32` | rateLimit middleware | 本番でKV必須時に未設定なら503で遮断する | 仕様回帰の見逃しにつながる可能性 | 条件: 本番でKV必須時に未設定なら503で遮断する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 163 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/rateLimit.test.ts:42` | rateLimit middleware | 開発環境ではKV未設定でもメモリフォールバックで通過する | 仕様回帰の見逃しにつながる可能性 | 条件: 開発環境ではKV未設定でもメモリフォールバックで通過する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 164 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/rateLimit.test.ts:52` | rateLimit middleware | KV利用時に上限超過で429を返す | 本番で会話停止・失敗率増加につながる可能性 | 条件: KV利用時に上限超過で429を返す。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 165 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/rateLimit.test.ts:69` | rateLimit middleware | メモリフォールバック時にキー数上限を超えた古いキーは退避される | 仕様回帰の見逃しにつながる可能性 | 条件: メモリフォールバック時にキー数上限を超えた古いキーは退避される。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 166 | Unit | UI/UX | `apps/v2-modern/tests/unit/riskLevelVisibility.test.ts:5` | shouldShowRiskLevelSelector | ask_risk_level かつ未選択のとき表示する | ユーザー操作不能・UI回帰につながる可能性 | 条件: ask_risk_level かつ未選択のとき表示する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 167 | Unit | UI/UX | `apps/v2-modern/tests/unit/riskLevelVisibility.test.ts:12` | shouldShowRiskLevelSelector | ask_why のとき表示しない | ユーザー操作不能・UI回帰につながる可能性 | 条件: ask_why のとき表示しない。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 168 | Unit | UI/UX | `apps/v2-modern/tests/unit/riskLevelVisibility.test.ts:19` | shouldShowRiskLevelSelector | ask_risk_level でも選択済みなら表示しない | ユーザー操作不能・UI回帰につながる可能性 | 条件: ask_risk_level でも選択済みなら表示しない。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 169 | Unit | UI/UX | `apps/v2-modern/tests/unit/riskLevelVisibility.test.ts:26` | shouldShowRiskLevelSelector | nextAction が未取得なら表示しない | ユーザー操作不能・UI回帰につながる可能性 | 条件: nextAction が未取得なら表示しない。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 170 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/schema.test.ts:6` | ChatMessageSchema | should accept valid messages | 本番で会話停止・失敗率増加につながる可能性 | Condition: accept valid messages. Expected: behavior/state/result is correct (Unit). |
| 171 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/schema.test.ts:14` | ChatMessageSchema | should reject system role | 本番で会話停止・失敗率増加につながる可能性 | Condition: reject system role. Expected: behavior/state/result is correct (Unit). |
| 172 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/schema.test.ts:27` | ChatMessageSchema | should reject content that is too long | 本番で会話停止・失敗率増加につながる可能性 | Condition: reject content that is too long. Expected: behavior/state/result is correct (Unit). |
| 173 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/schema.test.ts:39` | ChatMessageSchema | should accept longer assistant messages | 本番で会話停止・失敗率増加につながる可能性 | Condition: accept longer assistant messages. Expected: behavior/state/result is correct (Unit). |
| 174 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/schema.test.ts:48` | ChatMessageSchema | should reject control characters | 本番で会話停止・失敗率増加につながる可能性 | Condition: reject control characters. Expected: behavior/state/result is correct (Unit). |
| 175 | Unit | セキュリティ | `apps/v2-modern/tests/unit/securityMode.test.ts:10` | securityMode helpers | ENVIRONMENT / SENTRY_ENV が production の場合は本番扱いになる | 不正アクセス許容・本番遮断不備につながる可能性 | 条件: ENVIRONMENT / SENTRY_ENV が production の場合は本番扱いになる。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 176 | Unit | セキュリティ | `apps/v2-modern/tests/unit/securityMode.test.ts:16` | securityMode helpers | APIトークン必須判定は明示フラグを優先する | 不正アクセス許容・本番遮断不備につながる可能性 | 条件: APIトークン必須判定は明示フラグを優先する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 177 | Unit | セキュリティ | `apps/v2-modern/tests/unit/securityMode.test.ts:23` | securityMode helpers | RATE_LIMIT_KV必須判定とCORS厳格判定は本番デフォルトになる | 不正アクセス許容・本番遮断不備につながる可能性 | 条件: RATE_LIMIT_KV必須判定とCORS厳格判定は本番デフォルトになる。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 178 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/speechRecognitionErrors.test.ts:5` | speechRecognitionErrors | normalizeSpeechRecognitionError: "service not allowed" を service-not-allowed に正規化する | 本番で会話停止・失敗率増加につながる可能性 | 条件: normalizeSpeechRecognitionError: "service not allowed" を service-not-allowed に正規化する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 179 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/speechRecognitionErrors.test.ts:9` | speechRecognitionErrors | getSpeechRecognitionErrorMessage: service-not-allowed は短い文言になる | 本番で会話停止・失敗率増加につながる可能性 | 条件: getSpeechRecognitionErrorMessage: service-not-allowed は短い文言になる。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 180 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/useChat.retry.test.tsx:34` | useChat retry behavior | タイムアウト時のみリトライを有効化し、リトライでユーザーメッセージを重複送信しない | 本番で会話停止・失敗率増加につながる可能性 | 条件: タイムアウト時のみリトライを有効化し、リトライでユーザーメッセージを重複送信しない。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 181 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/useChat.retry.test.tsx:73` | useChat retry behavior | 非タイムアウトエラーではリトライを有効化しない | 本番で会話停止・失敗率増加につながる可能性 | 条件: 非タイムアウトエラーではリトライを有効化しない。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 182 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/useChat.retry.test.tsx:85` | useChat retry behavior | 429エラーではリトライを有効化し、待機案内を表示する | 本番で会話停止・失敗率増加につながる可能性 | 条件: 429エラーではリトライを有効化し、待機案内を表示する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 183 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/useChat.retry.test.tsx:103` | useChat retry behavior | AI_RESPONSE_INVALID_SCHEMA は混雑文言ではなく形式エラー文言を表示する | 本番で会話停止・失敗率増加につながる可能性 | 条件: AI_RESPONSE_INVALID_SCHEMA は混雑文言ではなく形式エラー文言を表示する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 184 | Unit | 機能整合 | `apps/v2-modern/tests/unit/useChat.shortcuts.test.tsx:35` | useChat shortcuts | applyRiskLevelSelectionはAPIを呼ばず、対策フェーズへ進める | 仕様回帰の見逃しにつながる可能性 | 条件: applyRiskLevelSelectionはAPIを呼ばず、対策フェーズへ進める。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 185 | Unit | UI/UX | `apps/v2-modern/tests/unit/useChat.shortcuts.test.tsx:52` | useChat shortcuts | 1件目で2件目の対策が揃っても自動で2件目KYへ遷移せず、確認メッセージを表示する | ユーザー操作不能・UI回帰につながる可能性 | 条件: 1件目で2件目の対策が揃っても自動で2件目KYへ遷移せず、確認メッセージを表示する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 186 | Unit | UI/UX | `apps/v2-modern/tests/unit/useChat.shortcuts.test.tsx:86` | useChat shortcuts | 2件目で対策が2件揃うと、行動目標設定へ進む確認メッセージを表示する | ユーザー操作不能・UI回帰につながる可能性 | 条件: 2件目で対策が2件揃うと、行動目標設定へ進む確認メッセージを表示する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 187 | Unit | 機能整合 | `apps/v2-modern/tests/unit/useChat.shortcuts.test.tsx:128` | useChat shortcuts | 1件目完了待ち中は「2件目に移る」発話でAPIなしに1件目を確定できる | 仕様回帰の見逃しにつながる可能性 | 条件: 1件目完了待ち中は「2件目に移る」発話でAPIなしに1件目を確定できる。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 188 | Unit | 機能整合 | `apps/v2-modern/tests/unit/useChat.shortcuts.test.tsx:154` | useChat shortcuts | 1件目で3件目の対策を追記した後は追加対策を受け付けず、完了操作を促す | 仕様回帰の見逃しにつながる可能性 | 条件: 1件目で3件目の対策を追記した後は追加対策を受け付けず、完了操作を促す。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 189 | Unit | 機能整合 | `apps/v2-modern/tests/unit/useChat.shortcuts.test.tsx:231` | useChat shortcuts | 危険2件が保存済みなら、KY完了でAPI無しのままセッション完了に進める | 仕様回帰の見逃しにつながる可能性 | 条件: 危険2件が保存済みなら、KY完了でAPI無しのままセッション完了に進める。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 190 | Unit | 機能整合 | `apps/v2-modern/tests/unit/useChat.shortcuts.test.tsx:271` | useChat shortcuts | 行動目標入力フェーズでは、明確な目標入力をローカル確定してAPI呼び出しを抑止する | 仕様回帰の見逃しにつながる可能性 | 条件: 行動目標入力フェーズでは、明確な目標入力をローカル確定してAPI呼び出しを抑止する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 191 | Unit | 機能整合 | `apps/v2-modern/tests/unit/useChat.shortcuts.test.tsx:303` | useChat shortcuts | 行動目標が既にある場合は、完了意思のみの発話でもAPI無しで確認フェーズへ進める | 仕様回帰の見逃しにつながる可能性 | 条件: 行動目標が既にある場合は、完了意思のみの発話でもAPI無しで確認フェーズへ進める。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 192 | Unit | UI/UX | `apps/v2-modern/tests/unit/useChat.shortcuts.test.tsx:336` | useChat shortcuts | 最終安全確認4項目が揃うと、ローカル完了で完了画面へ進める | 仕様回帰の見逃しにつながる可能性 | 条件: 最終安全確認4項目が揃うと、ローカル完了で完了画面へ進める。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 193 | Unit | 機能整合 | `apps/v2-modern/tests/unit/useChat.shortcuts.test.tsx:379` | useChat shortcuts | 確認ステータス以外では最終安全確認を完了できない | 仕様回帰の見逃しにつながる可能性 | 条件: 確認ステータス以外では最終安全確認を完了できない。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 194 | Unit | UI/UX | `apps/v2-modern/tests/unit/useChat.shortcuts.test.tsx:391` | useChat shortcuts | 行動目標確定後は、チェック完了まで自動で完了状態に遷移しない | ユーザー操作不能・UI回帰につながる可能性 | 条件: 行動目標確定後は、チェック完了まで自動で完了状態に遷移しない。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 195 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/useTTS.recovery.test.tsx:69` | useTTS recovery guard | TTS状態が固着した場合に自動で stopSpeaking する | 仕様回帰の見逃しにつながる可能性 | 条件: TTS状態が固着した場合に自動で stopSpeaking する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 196 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/useTTS.recovery.test.tsx:88` | useTTS recovery guard | speechSynthesis が実際に speaking 中なら固着回復は発火しない | 仕様回帰の見逃しにつながる可能性 | 条件: speechSynthesis が実際に speaking 中なら固着回復は発火しない。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 197 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/useTTS.recovery.test.tsx:107` | useTTS recovery guard | not-allowed で失敗した読み上げは次のユーザー操作で1回だけ再試行する | 本番で会話停止・失敗率増加につながる可能性 | 条件: not-allowed で失敗した読み上げは次のユーザー操作で1回だけ再試行する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 198 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/useTTS.recovery.test.tsx:138` | useTTS recovery guard | voiceschanged 後は更新された日本語Voiceを読み上げに使用する | ユーザー操作不能・UI回帰につながる可能性 | 条件: voiceschanged 後は更新された日本語Voiceを読み上げに使用する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 199 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/useTTS.recovery.test.tsx:164` | useTTS recovery guard | 読み上げエラー時に onTtsError コールバックへエラーコードを通知する | 本番で会話停止・失敗率増加につながる可能性 | 条件: 読み上げエラー時に onTtsError コールバックへエラーコードを通知する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 200 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/useVoiceRecognition.resilience.test.tsx:92` | useVoiceRecognition resilience | 初回 start 失敗後も autoRestart で再試行して復帰する | 本番で会話停止・失敗率増加につながる可能性 | 条件: 初回 start 失敗後も autoRestart で再試行して復帰する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 201 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/useVoiceRecognition.resilience.test.tsx:115` | useVoiceRecognition resilience | onstart が返らない初回ハングでもウォッチドッグ経由で再試行して復帰する | 本番で会話停止・失敗率増加につながる可能性 | 条件: onstart が返らない初回ハングでもウォッチドッグ経由で再試行して復帰する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 202 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/useVoiceRecognition.resilience.test.tsx:136` | useVoiceRecognition resilience | audio-capture は段階的に再試行し、上限超過後は自動再開を停止する | 本番で会話停止・失敗率増加につながる可能性 | 条件: audio-capture は段階的に再試行し、上限超過後は自動再開を停止する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 203 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/useVoiceRecognition.resilience.test.tsx:177` | useVoiceRecognition resilience | audio-capture 復帰後に発話結果を受けると再試行遅延を500msへリセットする | 本番で会話停止・失敗率増加につながる可能性 | 条件: audio-capture 復帰後に発話結果を受けると再試行遅延を500msへリセットする。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 204 | Unit | UI/UX | `apps/v2-modern/tests/unit/useVoiceRecognition.resilience.test.tsx:217` | useVoiceRecognition resilience | 旧インスタンスの onend が遅延発火しても、現行インスタンスを停止しない | ユーザー操作不能・UI回帰につながる可能性 | 条件: 旧インスタンスの onend が遅延発火しても、現行インスタンスを停止しない。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 205 | Unit | 機能整合 | `apps/v2-modern/tests/unit/validation.hazardSection.test.ts:15` | isHazardSectionComplete | 危険情報4項目がそろっていると true を返す | 仕様回帰の見逃しにつながる可能性 | 条件: 危険情報4項目がそろっていると true を返す。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 206 | Unit | 機能整合 | `apps/v2-modern/tests/unit/validation.hazardSection.test.ts:19` | isHazardSectionComplete | 危険度が未入力だと false を返す | 仕様回帰の見逃しにつながる可能性 | 条件: 危険度が未入力だと false を返す。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 207 | Unit | 機能整合 | `apps/v2-modern/tests/unit/validation.hazardSection.test.ts:25` | isHazardSectionComplete | whyDangerous が非回答のみだと false を返す | 仕様回帰の見逃しにつながる可能性 | 条件: whyDangerous が非回答のみだと false を返す。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 208 | Unit | 機能整合 | `apps/v2-modern/tests/unit/validation.hazardSection.test.ts:33` | isWorkItemComplete | 危険情報4項目が揃っていても対策が2件未満なら false | 仕様回帰の見逃しにつながる可能性 | 条件: 危険情報4項目が揃っていても対策が2件未満なら false。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 209 | Unit | 機能整合 | `apps/v2-modern/tests/unit/validation.nonAnswer.test.ts:5` | validation - non-answer filtering | 対策の「なし」はカウントせず、完了扱いにならない | 仕様回帰の見逃しにつながる可能性 | 条件: 対策の「なし」はカウントせず、完了扱いにならない。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 210 | Unit | 機能整合 | `apps/v2-modern/tests/unit/validation.nonAnswer.test.ts:19` | validation - non-answer filtering | 要因の「特になし」はカウントせず、完了扱いにならない | 仕様回帰の見逃しにつながる可能性 | 条件: 要因の「特になし」はカウントせず、完了扱いにならない。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 211 | Unit | UI/UX | `apps/v2-modern/tests/unit/voiceConversationMode.pages.test.tsx:53` | Voice conversation mode switch | ホーム画面は通常モードを初期表示し、切替できる | ユーザー操作不能・UI回帰につながる可能性 | 条件: ホーム画面は通常モードを初期表示し、切替できる。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 212 | Unit | UI/UX | `apps/v2-modern/tests/unit/voiceConversationMode.pages.test.tsx:65` | Voice conversation mode switch | ホームで切替えた状態を会話画面でも共有し、会話画面から戻せる | ユーザー操作不能・UI回帰につながる可能性 | 条件: ホームで切替えた状態を会話画面でも共有し、会話画面から戻せる。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 213 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/workers/chat.execution.test.ts:18` | runChatCompletionFlow | finish_reason=length の壊れたJSONは1回だけ再生成して回復する | 本番で会話停止・失敗率増加につながる可能性 | 条件: finish_reason=length の壊れたJSONは1回だけ再生成して回復する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 214 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/workers/chat.execution.test.ts:73` | runChatCompletionFlow | スキーマ不整合時は invalid_schema を返す | 本番で会話停止・失敗率増加につながる可能性 | 条件: スキーマ不整合時は invalid_schema を返す。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 215 | Unit | 耐障害性 | `apps/v2-modern/tests/unit/workers/chat.execution.test.ts:118` | runChatCompletionFlow | providerFallbackEnabled=false のとき Gemini失敗時にOpenAIへフォールバックしない | 本番で会話停止・失敗率増加につながる可能性 | 条件: providerFallbackEnabled=false のとき Gemini失敗時にOpenAIへフォールバックしない。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 216 | Unit | 機能整合 | `apps/v2-modern/tests/unit/workers/chat.normalize.test.ts:5` | chat normalize helpers | 汎用的な相づち応答は会話進行用の文面へ補正する | 仕様回帰の見逃しにつながる可能性 | 条件: 汎用的な相づち応答は会話進行用の文面へ補正する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 217 | Unit | 機能整合 | `apps/v2-modern/tests/unit/workers/chat.normalize.test.ts:16` | chat normalize helpers | actionGoal入力時に ask_goal を confirm に補正する | 仕様回帰の見逃しにつながる可能性 | 条件: actionGoal入力時に ask_goal を confirm に補正する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 218 | Unit | 機能整合 | `apps/v2-modern/tests/unit/workers/chat.normalize.test.ts:32` | chat normalize helpers | 未確定の空値を compactExtractedData で除去する | 仕様回帰の見逃しにつながる可能性 | 条件: 未確定の空値を compactExtractedData で除去する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 219 | Unit | 機能整合 | `apps/v2-modern/tests/unit/workers/fieldGuard.test.ts:5` | applyKyFieldGuard | 原因欄に作業文が混入している場合は除外し ask_why に戻す | 仕様回帰の見逃しにつながる可能性 | 条件: 原因欄に作業文が混入している場合は除外し ask_why に戻す。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 220 | Unit | 機能整合 | `apps/v2-modern/tests/unit/workers/fieldGuard.test.ts:17` | applyKyFieldGuard | 妥当な原因文は保持する | 仕様回帰の見逃しにつながる可能性 | 条件: 妥当な原因文は保持する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 221 | Unit | 機能整合 | `apps/v2-modern/tests/unit/workers/fieldGuard.test.ts:31` | applyKyFieldGuard | 危険内容確認中の nextAction は尊重する | 仕様回帰の見逃しにつながる可能性 | 条件: 危険内容確認中の nextAction は尊重する。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 222 | Unit | 機能整合 | `apps/v2-modern/tests/unit/workers/fieldGuard.test.ts:43` | applyKyFieldGuard | nextAction が未設定でも混入除去後は ask_why に戻す | 仕様回帰の見逃しにつながる可能性 | 条件: nextAction が未設定でも混入除去後は ask_why に戻す。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
| 223 | Unit | 機能整合 | `apps/v2-modern/tests/unit/workers/fieldGuard.test.ts:54` | applyKyFieldGuard | 作業中を含む妥当な原因文は誤って除外しない | 仕様回帰の見逃しにつながる可能性 | 条件: 作業中を含む妥当な原因文は誤って除外しない。期待: 条件に対するレスポンス/状態遷移/副作用が仕様どおりであること。 |
