# 利用者向け機能一覧（v2-modern）

作成日: 2026-02-03
作成者: Codex＋GPT-5
更新日: 2026-02-17（完全音声会話モード追加、TTS再生後のマイク自動再開を安定化）

## 対象読者と目的
この資料は、現場作業者が「このアプリで何ができるか」を実感できるようにまとめた機能一覧です。各機能の内容と、発揮される条件（いつ・どの状態で使えるか）を具体的に記載しています。

---

## 機能一覧（利用者目線）

### 1. KYセッション開始（基本情報入力）
**内容**
- 作業者名・現場名・天候・工程・体調を入力して、KY活動を開始できます。

**発揮される条件**
- ホーム画面で「作業者名」と「現場名」を入力すること。
- 入力後、「KY活動を開始」ボタンを押すとセッションが開始されます。

**利用例**
- 「田中太郎 / 〇〇ビル改修工事 / 晴れ / 組み立て / よい」を入力して開始。

---

### 2. AI対話による危険・要因・対策の整理
**内容**
- AIが順番に質問し、作業内容 → 危険 → 要因 → 対策の流れで整理できます。
- 会話は短い回答でも進みます。

**発揮される条件**
- セッション開始後、チャット画面に移動していること。
- 入力欄からメッセージを送信すること。

**利用例**
- 「足場の組立をする」→「高所作業で転落の危険」→「手すりがない」→「安全帯を二丁掛け」。

---

### 3. 危険度の選択
**内容**
- 作業の危険度を1〜5で選び、重要度を明確にできます。

**発揮される条件**
- AIが危険度を聞いている状態になると、画面下に危険度ボタンが表示されます。
- 1〜5のボタンから選択します。

**利用例**
- 「危険度は4」と判断し、ボタン4を押す。

---

### 4. 行動目標の確定
**内容**
- 最後に「今日一番意識する行動目標」を決めて終了できます。

**発揮される条件**
- 作業項目が完了し、AIが行動目標を求める段階に到達していること。

**利用例**
- 「高所作業は必ず二丁掛けを徹底する」。

---

### 5. 完了画面と事後フィードバック（任意）
**内容**
- セッション完了時に、AIからのフィードバックを受け取れます。
- ほめポイント / 次回へのヒント / 補足リスク / 行動目標の磨き込みが表示されます。

**発揮される条件**
- セッションが「完了」状態になっていること。
- フィードバック機能が有効（`VITE_ENABLE_FEEDBACK=1`）であること。
- APIトークンが設定されていること（`VITE_REQUIRE_API_TOKEN=1` の場合）。

**利用例**
- 「今日の良かった点：危険の洗い出しが具体的」
- 「次回へのヒント：足元確認を一言添える」

---

### 6. PDF記録のダウンロード
**内容**
- KY活動の内容をPDFとして保存できます。

**発揮される条件**
- 完了画面で「PDF記録をダウンロード」を押すこと。

**利用例**
- 作業後にPDFを提出用として保存。

---

### 7. 履歴閲覧（一覧/詳細）
**内容**
- 過去のKY記録を一覧で確認し、詳細を開けます。

**発揮される条件**
- 1件以上のセッションが完了し、履歴として保存されていること。
- ホーム画面から「過去の記録を見る」を押す。

**利用例**
- 先週の作業内容や危険を見返す。

---

### 8. 履歴からの再利用（引用スタート）
**内容**
- 過去の記録から基本情報をコピーして、新しいKYを開始できます。

**発揮される条件**
- 履歴詳細画面で「この記録を元に新規作成」を押すこと。

**利用例**
- 同じ現場の作業を再開する際に、現場名・作業者名を再入力せずに開始。

---

### 9. 音声入力（Mic）
**内容**
- マイクで話した内容を自動で入力できます。

**発揮される条件**
- ブラウザが音声認識に対応していること。
- 画面下のマイクボタンが有効な状態であること。
- マイク使用の許可が必要。

**利用例**
- 手が塞がっているときに「足場の点検をする」と話して入力。 

---

### 10. 音声読み上げ（TTS）
**内容**
- AIのメッセージを音声で読み上げできます。

**発揮される条件**
- ブラウザが音声合成に対応していること。
- AIメッセージ横のスピーカーボタンを押す。

**利用例**
- 手を止めずにAIの質問内容を聞く。

---

### 11. 直近リスクの参照表示
**内容**
- 最近の記録で繰り返し出ている危険を表示し、注意喚起できます。

**発揮される条件**
- 過去の履歴が存在すること。
- 機能が有効（`VITE_ENABLE_CONTEXT_INJECTION=1`）であること。

**利用例**
- 「直近3日以内に同様の危険」として繰り返しリスクが表示される。

---

### 12. 履歴のエクスポート（CSV / JSON）
**内容**
- 履歴データをCSVまたはJSONで保存できます。

**発揮される条件**
- 履歴一覧画面で「CSV出力」「JSON出力」を押す。

**利用例**
- 管理者へ提出するためにCSV形式で保存。

---

### 13. 完全音声会話モード（切替）
**内容**
- 通常モードと完全音声会話モードを、ホーム画面と会話画面の両方で切り替えできます。
- 完全音声会話モードでは、AI応答の自動読み上げと音声認識の自動再開、最終認識結果の自動送信を行います。
- TTS再生中はマイクを一時停止し、再生終了後は音声認識を1回だけ再開します（重複開始を抑止）。

**発揮される条件**
- モード切替で「完全音声会話」を選択していること。
- ブラウザが音声認識・音声合成に対応し、マイク許可があること。

**利用例**
- ホーム画面で「完全音声会話」をONにして開始し、会話画面でハンズフリーに近い運用を行う。

---

## 補足（前提/制約）
- フィードバック機能は環境変数設定とネットワーク接続が必要です。
- 音声入力・読み上げはブラウザの対応状況に依存します。
- モードの初期状態は通常モードです（ページ再読み込み後も通常モードで開始）。
- 履歴は端末内（ブラウザのデータベース）に保存されます。

---

## 追加の補足情報（多面的な注意点）

**データ保存と保持**
履歴は端末内（IndexedDB）に保存されます。古い記録は自動的に整理され、一定期間（90日）または上限件数（100件）を超えると古い順に削除されます。ブラウザのデータ消去を行うと履歴も消えます。

**通信が必要な機能**
AIチャットと事後フィードバックはネットワーク接続が必要です。通信できない場合、チャット応答やフィードバックは取得できません。

**認証と利用制限**
環境設定によっては、APIトークンが必須になります。必須設定時は、トークンがないとフィードバックが取得できません。

**参考情報の扱い**
「直近の繰り返し危険」など過去履歴の情報は参考です。今日の現場状況を最優先し、新しい危険がないか必ず確認してください。

**プライバシー配慮**
フィードバック取得時には、メールアドレスや電話番号などをマスクする処理が入っています。ただし完全な匿名化ではないため、入力内容には注意してください。

**音声機能の前提**
音声入力・読み上げはブラウザの対応とマイク許可が必要です。非対応環境ではボタンが表示されません。
