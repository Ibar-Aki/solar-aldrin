# Voice KY Assistant 要件定義書 v2

本ドキュメントは **Voice KY Assistant** の機能要件、業務フロー、データ要件、非機能要件、受入条件、例外・エラー対応を定義する。

---

## 1. 目的と前提

### 1.1 目的
* 音声対話で危険予知（KY）を作成し、現場の負担を削減する。
* 監査に耐える記録を自動生成し、再利用できるデータとして蓄積する。

### 1.2 前提
* Phase 2の対象は**ソロKY**と**PDF自動生成**である。
* ネットワーク不安定な現場を想定し、入力内容の消失を防止する。

---

## 2. ユーザーと権限

| ロール | 想定ユーザー | 主な権限 |
| :--- | :--- | :--- |
| 作業員 | 現場作業者 | KY作成、PDF保存 |
| 現場長 | 現場責任者 | KY作成、PDF保存、記録の確認 |
| 管理者 | 管理部門 | 運用ポリシー設定、監査対応 |

---

## 3. 機能要件

| ID | 機能名 | 概要 | フェーズ | 受入条件 |
| :--- | :--- | :--- | :--- | :--- |
| FR-01 | 音声対話KY | 音声入力に対してAIが質問し、KY記録を作成する。 | Phase 2 | 5分以内の対話で必須項目が埋まること |
| FR-02 | 深掘り質問 | 抽象的回答に対して具体化質問を行う。 | Phase 2 | 「ヨシ」など曖昧回答が3回以上続かないこと |
| FR-03 | PDF自動生成 | 対話完了後にPDFを生成する。 | Phase 2 | 必須項目がPDFに反映され、1分以内に生成されること |
| FR-04 | 他社KY取り込み | 他社指定KY用紙をOCRで取り込み自社項目に変換する。 | Phase 3 | OCR結果の確認・修正が可能であること |
| FR-05 | 現場写真診断 | 画像認識で危険箇所を指摘する。 | Phase 3 | 指摘内容がKY項目として保存されること |
| FR-06 | チームKY | 複数人会話を統合しKYにまとめる。 | Phase 4 | 発言者の区別が80%以上の正確性で行われること |
| FR-07 | 類似事例リコメンド | 過去事例から注意喚起を行う。 | Phase 4 | 類似事例が提示されるまで10秒以内であること |

---

## 4. 業務フロー

### 4.1 ソロKY（標準フロー）
1. **起動**: アプリを開き「KY開始」を押す。
2. **基本情報入力**: 作業内容・場所・日時を音声入力する。
3. **対話**: AIが危険ポイントと対策を質問する。
4. **確認**: PDFプレビューで内容を確認する。
5. **保存/共有**: PDFを保存または共有する。

### 4.2 例外フロー（音声認識失敗）
1. 音声認識に失敗した場合、画面に再入力ボタンを表示する。
2. ユーザーは再入力を選択し、テキスト入力に切り替えられる。
3. 再入力した内容は音声入力と同じ項目に反映される。

---

## 5. データ要件

### 5.1 必須項目
* 作業内容
* 作業場所
* 作業日時
* 危険ポイント
* 対策内容

### 5.2 保存期間
* ローカル保存は30日を標準とし、削除前にユーザーに通知する。

### 5.3 データ整合性
* PDFと画面表示内容が一致していること。
* 保存後の改ざん防止のため、ハッシュ値を付与する。

---

## 6. 非機能要件

### 6.1 レスポンス速度
* 音声入力完了からAI応答開始まで3秒以内。

### 6.2 操作性
* 手袋モードを前提とした大きなボタン配置。
* 二重タップ防止。

### 6.3 環境耐性
* 騒音下でも音声認識が可能であること。
* オフライン時の入力内容保持。

### 6.4 セキュリティ
* APIキーは必ずBFFを経由しクライアントには保持させない。
* 現場写真は解析後に削除、または暗号化保存する。

### 6.5 可用性・復旧性
* 障害復旧目標（RTO）: 4時間以内。
* データのバックアップを日次で取得する。

### 6.6 監査ログ
* PDF生成、保存、削除の操作ログを記録する。

---

## 7. 例外・エラー対応

| エラー種別 | 想定原因 | 影響 | 対策 |
| :--- | :--- | :--- | :--- |
| 音声認識失敗 | 騒音、マイク不良 | 入力不能 | 再入力UIとテキスト入力切替 |
| PDF生成失敗 | 生成処理の例外 | 記録未保存 | 再生成ボタンとエラー通知 |
| データ保存失敗 | ストレージ容量不足 | 記録消失 | 容量警告と削除案内 |
| ネットワーク断 | 通信不安定 | データ送信不可 | オフライン保存と再送 |

---

## 8. UI/UX 要件

### 8.1 画面構成
* トップ画面（KY開始ボタン）
* 対話画面（チャット形式）
* PDFプレビュー画面

### 8.2 視覚フィードバック
* 録音中は波形アニメーションを表示する。
* AI応答中は「確認しますね」などの表示で待機ストレスを軽減する。

---

## 9. 受入基準のまとめ

* FR-01〜FR-03の受入条件を満たすこと。
* PDF生成成功率99%以上。
* 音声入力成功率95%以上。
