# Phase 2.2 リファクタリング (Code Health) 保留に関するレポート

**作成日**: 2026-01-27
**ステータス**: 保留 (Pending)

## 概要

Phase 2.1完了後、コードの健全性を高めるためのPhase 2.2リファクタリング（構造化出力の導入、Store分割）が提案されましたが、以下のデメリット・リスクを考慮し、**当面の間保留**とすること決定しました。

## 識別されたデメリット・リスク一覧

### 1. RF-01: 構造化出力 (Structured Output) の導入

* **応答柔軟性の低下**
  * AIに対し厳密なJSON出力を強制するため、予期せぬユーザー入力や雑談に対する柔軟な応答（「それはわかりませんが...」のような自然な切り返し）が困難になる可能性があります。
  * スキーマ不適合時のエラーハンドリングが複雑になります。
* **デバッグ難易度の上昇**
  * 従来の「画面にそのままテキストが出る」形式と異なり、JSONパースエラーが発生した際に画面上で原因が即座に判別できず、サーバーログを確認する手間が発生します。
* **運用コストの増加**
  * プロンプトだけでなく、JSONスキーマ（TypeScript型定義）のメンテナンスがセットで必要になります。項目追加時の修正箇所が増えます。

### 2. RF-02: Storeの分割 (Slicing)

* **開発の一時停止（破壊的変更）**
  * `kyStore.ts` はアプリケーションの中核であり、分割作業中はコンパイルエラーが多発し、他の機能開発や動作確認が一切できなくなります。
* **既存データの消失**
  * Storeの構造変更に伴い、`localStorage` に保存されているユーザーの作業中データ（セッション情報）との互換性が失われ、リセットが必要になります。
* **コード記述量の増加**
  * ファイル分割により見通しは良くなりますが、スライス間の連携や型定義のためのボイラープレートコード（定型記述）は増加します。

### 3. プロジェクト全体への影響

* **機会損失 (Opportunity Cost)**
  * リファクタリング作業（見積もり：0.5日〜1日）の間、PDF出力や音声認識など、ユーザーにとって価値のある新機能の実装がストップします。

## 結論

現状の「文字列マッチングによるデータ抽出」には将来的な脆弱性があるものの、現時点では正常に動作しており、直近の機能追加（PDF、音声）を優先するためにリファクタリングは先送りします。
Phase 3以降、あるいはデータ抽出の不具合が頻発したタイミングで再検討します。
