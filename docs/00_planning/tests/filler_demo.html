<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¾…æ©Ÿãƒ•ã‚£ãƒ©ãƒ¼æ¼”å‡º (Waiting Filler) æ¯”è¼ƒãƒ‡ãƒ¢ v2</title>
    <style>
        body {
            font-family: "Helvetica Neue", Arial, sans-serif;
            padding: 20px;
            line-height: 1.6;
            background: #f0f2f5;
            color: #333;
        }

        .container {
            max-width: 700px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #1a202c;
            font-size: 1.8rem;
            margin-bottom: 24px;
            text-align: center;
        }

        .description {
            margin-bottom: 30px;
            text-align: center;
            color: #4a5568;
        }

        .demo-section {
            border: 2px solid #e2e8f0;
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 30px;
            background: #fff;
            transition: all 0.3s ease;
        }

        .demo-section.active {
            border-color: #3182ce;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.2);
        }

        .section-title {
            font-weight: bold;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 16px;
        }

        .badge {
            font-size: 0.8rem;
            padding: 4px 8px;
            border-radius: 4px;
            color: white;
        }

        .badge-bad {
            background: #e53e3e;
        }

        .badge-good {
            background: #38a169;
        }

        button {
            background: #3182ce;
            color: white;
            border: none;
            padding: 12px 24px;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            width: 100%;
            transition: background 0.2s;
        }

        button:hover {
            background: #2c5282;
        }

        button:disabled {
            background: #cbd5e0;
            cursor: progress;
        }

        /* Timeline Visualization */
        .timeline {
            margin-top: 20px;
            position: relative;
            height: 60px;
            background: #edf2f7;
            border-radius: 8px;
            overflow: hidden;
            display: flex;
            align-items: center;
        }

        .timeline-track {
            width: 100%;
            height: 4px;
            background: #cbd5e0;
            position: absolute;
            z-index: 1;
        }

        .timeline-event {
            position: absolute;
            top: 10px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            color: white;
            border-radius: 4px;
            z-index: 2;
            opacity: 0.3;
            transition: opacity 0.3s;
        }

        .event-user {
            left: 0%;
            width: 20%;
            background: #4a5568;
        }

        /* 0-1s */
        .event-gap {
            left: 20%;
            width: 60%;
            background: #ecc94b;
            color: #744210;
        }

        /* 1-4s (3s gap) */
        .event-ai {
            left: 80%;
            width: 20%;
            background: #3182ce;
        }

        /* 4-5s */
        .event-filler {
            left: 20%;
            width: 20%;
            background: #e53e3e;
            z-index: 3;
        }

        /* 1-2s */

        .current-time-bar {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 2px;
            background: red;
            z-index: 10;
            transition: left 0.1s linear;
            display: none;
        }

        .active .timeline-event {
            opacity: 1;
        }

        .log-area {
            margin-top: 10px;
            font-family: monospace;
            font-size: 0.9rem;
            min-height: 1.5em;
            color: #2d3748;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ãƒ•ã‚£ãƒ©ãƒ¼æ¼”å‡º (Waiting Filler) ä½“é¨“ãƒ‡ãƒ¢</h1>
        <p class="description">AIã®å›ç­”ç”Ÿæˆã«ã‹ã‹ã‚‹ã€Œå¾…ã¡æ™‚é–“ï¼ˆç´„5ç§’ï¼‰ã€ã‚’ã©ã†æ„Ÿã˜ã‚‹ã‹æ¯”è¼ƒã—ã¦ãã ã•ã„ã€‚<br>éŸ³é‡ONå¿…é ˆã§ã™ã€‚</p>

        <!-- A: ç¾çŠ¶ -->
        <div class="demo-section" id="section-a">
            <div class="section-title">
                <span class="badge badge-bad">ç¾çŠ¶</span> ãƒ‘ã‚¿ãƒ¼ãƒ³Aï¼šãã®ã¾ã¾å¾…ã¤
            </div>
            <p>é€ä¿¡å¾Œã€ã‚µãƒ¼ãƒãƒ¼ã®å¿œç­”ãŒè¿”ã£ã¦ãã‚‹ã¾ã§ç„¡éŸ³ã§ã™ã€‚</p>
            <button onclick="startDemo('A')">â–¶ ãƒ‘ã‚¿ãƒ¼ãƒ³Aã‚’å†ç”Ÿ (ç´„6ç§’)</button>
            <div class="timeline">
                <div class="current-time-bar" id="bar-a"></div>
                <div class="timeline-event event-user">ã‚ãªãŸã®ç™ºè¨€</div>
                <div class="timeline-event event-gap">é€šä¿¡/æ€è€ƒä¸­ (5ç§’)</div>
                <div class="timeline-event event-ai">AIå›ç­”</div>
            </div>
            <div class="log-area" id="log-a">å¾…æ©Ÿä¸­...</div>
        </div>

        <!-- B: æ”¹å–„æ¡ˆ -->
        <div class="demo-section" id="section-b">
            <div class="section-title">
                <span class="badge badge-good">æ”¹å–„æ¡ˆ</span> ãƒ‘ã‚¿ãƒ¼ãƒ³Bï¼šãƒ•ã‚£ãƒ©ãƒ¼æ¼”å‡ºã‚ã‚Š
            </div>
            <p>é€ä¿¡ç›´å¾Œã€AIãŒã€Œç¢ºèªã—ã¾ã™ã€ã¨å³ç­”ã—ã¦ã‹ã‚‰æ€è€ƒã«å…¥ã‚Šã¾ã™ã€‚</p>
            <button onclick="startDemo('B')">â–¶ ãƒ‘ã‚¿ãƒ¼ãƒ³Bã‚’å†ç”Ÿ (ç´„6ç§’)</button>
            <div class="timeline">
                <div class="current-time-bar" id="bar-b"></div>
                <div class="timeline-event event-user">ã‚ãªãŸã®ç™ºè¨€</div>
                <div class="timeline-event event-filler" style="background:#38a169;">å³åº§ã«å¿œç­”</div>
                <div class="timeline-event event-gap" style="left:40%; width:40%;">æ€è€ƒä¸­ (æ®‹ã‚Š3ç§’)</div>
                <div class="timeline-event event-ai">AIå›ç­”</div>
            </div>
            <div class="log-area" id="log-b">å¾…æ©Ÿä¸­...</div>
        </div>
    </div>

    <script>
        const TOTAL_DURATION = 6000; // 6 sec total simulation
        const GAP_DURATION = 4000;   // 4 sec server wait

        function startDemo(type) {
            if (window.speechSynthesis.speaking) {
                window.speechSynthesis.cancel();
            }

            // UI Reset
            document.querySelectorAll('.demo-section').forEach(el => el.classList.remove('active'));
            document.getElementById(`section-${type.toLowerCase()}`).classList.add('active');
            document.querySelectorAll('button').forEach(b => b.disabled = true);

            const logEl = document.getElementById(`log-${type.toLowerCase()}`);
            const barEl = document.getElementById(`bar-${type.toLowerCase()}`);

            // Animation Start
            let startTime = Date.now();
            barEl.style.display = 'block';

            const animInterval = setInterval(() => {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / TOTAL_DURATION * 100, 100);
                barEl.style.left = `${progress}%`;

                if (elapsed >= TOTAL_DURATION) clearInterval(animInterval);
            }, 50);

            // --- Scenario Sequence ---

            // 1. User Speaks (0s)
            logEl.innerText = "ğŸ—£ï¸ ã‚ãªãŸ: ã€Œä½œæ¥­å†…å®¹ã¯ã€å¡—è£…ä½œæ¥­ã§ã™ã€";
            speak("ä½œæ¥­å†…å®¹ã¯ã€å¡—è£…ä½œæ¥­ã§ã™", () => {

                // User finished speaking.
                // 2. Network Wait Starts

                if (type === 'A') {
                    // Pattern A: Silence
                    logEl.innerText = "...... (ã‚·ãƒ¼ãƒ³) ......";

                    setTimeout(() => {
                        logEl.innerText = "ğŸ¤– AI: ã€Œåˆ†ã‹ã‚Šã¾ã—ãŸã€‚æ›æ°—è¨­å‚™ã¯ååˆ†ã§ã™ã‹ï¼Ÿã€";
                        speak("åˆ†ã‹ã‚Šã¾ã—ãŸã€‚æ›æ°—è¨­å‚™ã¯ååˆ†ã§ã™ã‹ï¼Ÿ", () => {
                            resetUI();
                        });
                    }, 4000); // Wait 4s

                } else {
                    // Pattern B: Filler
                    logEl.innerText = "ğŸ¤– AI: ã€Œç¢ºèªã—ã¦ã„ã¾ã™...ã€(å³ç­”)";

                    // Filler speaks IMMEDIATELY
                    speak("ç¢ºèªã—ã¦ã„ã¾ã™...", () => {
                        logEl.innerText = "â³ (AIãŒè€ƒãˆä¸­...)";

                        // Remaining wait time (Total wait 4s - Filler duration approx 1-1.5s)
                        // We simulate the gap simply by fixed timeout from user end, 
                        // but strictly sequencing TTS is safer.

                        setTimeout(() => {
                            logEl.innerText = "ğŸ¤– AI: ã€Œåˆ†ã‹ã‚Šã¾ã—ãŸã€‚æ›æ°—è¨­å‚™ã¯ååˆ†ã§ã™ã‹ï¼Ÿã€";
                            speak("åˆ†ã‹ã‚Šã¾ã—ãŸã€‚æ›æ°—è¨­å‚™ã¯ååˆ†ã§ã™ã‹ï¼Ÿ", () => {
                                resetUI();
                            });
                        }, 2500); // Wait remaining time
                    });
                }
            });

            function resetUI() {
                clearInterval(animInterval);
                barEl.style.display = 'none';
                document.querySelectorAll('button').forEach(b => b.disabled = false);
                logEl.innerText += " (å®Œäº†)";
            }
        }

        function speak(text, callback) {
            const uttr = new SpeechSynthesisUtterance(text);
            uttr.lang = "ja-JP";
            uttr.rate = 1.0; // Normal speed
            uttr.volume = 1.0;
            uttr.onend = () => {
                if (callback) callback();
            };
            window.speechSynthesis.speak(uttr);
        }
    </script>
</body>

</html>