# 📋 AIファシリ型KYシステム 要件定義書（v2.0）

**プロジェクト名**: Voice KY Assistant  
**バージョン**: 2.0（MVP版）  
**作成日**: 2026年1月20日  
**最終更新日**: 2026年1月21日

---

## 1. はじめに

### 1.1 ドキュメントの目的

本ドキュメントは、AIファシリ型KYシステム（Voice KY Assistant）のMVP開発に必要な要件を定義する。

### 1.2 スコープ

| 項目 | 内容 |
|------|------|
| 対象作業 | 足場設置作業のみ |
| 対象ユーザー | 建設現場の作業員（一人KY） |
| 対象デバイス | iPhone SE（会社支給） |
| 利用頻度 | 1日2回（朝・昼） |

### 1.3 前提条件

- ユーザーはiPhone SE（iOS 15以上）を所持
- モバイル通信環境あり（不安定な場合あり）
- ユーザーはスマホ操作にやや不慣れ
- 認証機能は不要

---

## 2. ユーザー要件

### 2.1 ユーザーストーリー

| ID | ストーリー | 受け入れ基準 |
|----|-----------|-------------|
| US-01 | 作業員として、話すだけでKYを完了したい | キーボード入力なしで完了できる |
| US-02 | 作業員として、何が危険か考えるのを手伝ってほしい | AIが深掘り質問をする |
| US-03 | 作業員として、KY記録をPDFで保存したい | 完了時にPDFが生成される |
| US-04 | 作業員として、シンプルに使いたい | 3タップ以内で開始できる |
| US-05 | 作業員として、KYの質を上げるヒントがほしい | 確認画面でアドバイスが表示される |
| US-06 | 作業員として、声が出せない/認識しない時でも使いたい | **テキスト入力でKYを実施できる** |

### 2.2 ペルソナ

```
名前: 田中さん（55歳）
職業: 足場作業員（経験30年）
端末: iPhone SE（会社支給）
ITスキル: LINEは使える、アプリは苦手
KYへの態度: 「意味はわかるけど、毎日同じこと書くのは面倒」
求めていること: 「楽にできて、ちゃんとしたKYになるなら使いたい」
```

---

## 3. 機能要件（MVP）

### 3.1 画面遷移

```
┌─────────────┐
│   ホーム    │
│  「KY開始」 │
│   ボタン    │
└──────┬──────┘
       │ タップ
       ▼
┌─────────────┐
│  作業選択   │
│ [足場設置]  │
└──────┬──────┘
       │ タップ
       ▼
┌─────────────┐
│   AI対話    │
│  音声入出力 │
│  (3-5分)    │
└──────┬──────┘
       │ 完了発話
       ▼
┌─────────────┐
│   確認画面  │
│ [修正][完了]│
└──────┬──────┘
       │ 完了タップ
       ▼
┌─────────────┐
│   完了画面  │
│  PDF表示    │
│  [履歴へ]   │
└─────────────┘
```

### 3.2 機能一覧

#### FR-01: ホーム画面

| 項目 | 内容 |
|------|------|
| 説明 | アプリ起動時の画面 |
| 要素 | 「KY開始」ボタン（大きく目立つ）、履歴リンク |
| 動作 | ボタンタップで作業選択へ遷移 |

#### FR-02: 作業選択

| 項目 | 内容 |
|------|------|
| 説明 | 作業種別を選択する |
| 要素 | 「足場設置」ボタン（MVP固定） |
| 動作 | タップでAI対話画面へ遷移 |
| 備考 | 将来的に複数作業に対応 |

#### FR-03: 天候情報取得

| 項目 | 内容 |
|------|------|
| 説明 | 現在地の天候情報を自動取得 |
| 入力 | GPS位置情報（ブラウザAPI） |
| 出力 | 天気、気温、風速 |
| API | OpenWeatherMap または 気象庁API |
| プライバシー | **位置情報は天候取得時のみ使用し、サーバには保存しない** |
| フォールバック | 取得失敗時は天候情報なしで続行 |

#### FR-04: 音声認識

| 項目 | 内容 |
|------|------|
| 説明 | ユーザーの音声をテキストに変換 |
| 技術 | Web Speech API（ブラウザ標準） |
| 言語 | 日本語 |
| フォールバック | **認識不可・iOSでの動作不良時は「キーボード入力モード」を提供する** |
| 精度目標 | 標準的な発話で90%以上 |

#### FR-05: 音声合成

| 項目 | 内容 |
|------|------|
| 説明 | AIの応答を音声で読み上げ |
| 技術 | Web Speech API または OpenAI TTS |
| 言語 | 日本語 |

#### FR-06: AI対話エンジン

| 項目 | 内容 |
|------|------|
| 説明 | KYをファシリテートするAI対話 |
| 技術 | OpenAI GPT-4o-mini API |
| 対話フロー | 下記詳細参照 |

**対話フロー詳細**:

```
1. [危険の洗い出し]
   AI: 「今日は{天候}ですね。足場設置作業で、
        どんな危険がありそうですか？」
   
   ユーザー回答 → 抽象的なら深掘り
   
   AI: 「それはどの作業の時ですか？
        もう少し具体的に教えてください」

2. [追加の危険確認]
   AI: 「他に気になることはありますか？」
   
   ユーザー回答 → なければ次へ

3. [対策確認]
   AI: 「{危険}に対して、どんな対策をしますか？」
   
   ユーザー回答 → 抽象的なら深掘り

4. [行動目標]
   AI: 「今日の合言葉を決めてください。
        例えば『安全帯ヨシ！』のような形で」
   
   ユーザー回答

5. [完了]
   AI: 「ありがとうございます。
        KY完了です。ご安全に！」
```

**AIプロンプト設計**:

```
あなたは建設現場の安全管理をサポートするAIアシスタントです。
作業員との対話を通じて、危険予知（KY）活動を支援します。

【役割】
- 作業員が自分で危険を考えられるよう、質問で導く
- 抽象的な回答には具体化を促す質問をする
- 否定せず、常に前向きなトーンで対話する

【対話のルール】
- 1回の発話は50文字以内
- 専門用語は避け、わかりやすい言葉で話す
- 「〜ですね」「いいですね」など肯定的な相槌を入れる

【今日の情報】
- 作業: 足場設置
- 天候: {weather}
- 時間帯: {time_of_day}

【足場設置作業の典型的な危険】
（参考情報として回答を評価するのに使用）
- 墜落・転落（布板設置時、昇降時）
- 落下物（資材、工具）
- 倒壊（壁つなぎ不足）
- 気象条件（強風、雨で滑りやすい）
```

#### FR-07: 確認画面

| 項目 | 内容 |
|------|------|
| 説明 | AI対話の結果を確認・修正 + **KYアドバイス表示** |
| 要素 | 危険項目リスト、対策、行動目標、**アドバイス表示エリア**、修正ボタン、完了ボタン |
| 動作 | 修正→該当箇所を音声または**テキスト**で再入力、完了→PDF生成へ |
| 運用 | **PDF印刷後、作業員・職長が自署・押印を行い、監査記録とする** |

#### FR-07-2: KYアドバイス機能（MVP新機能）

| 項目 | 内容 |
|------|------|
| 説明 | KY内容を評価し、質を向上させるアドバイスを表示 |
| 表示タイミング | 確認画面表示時に自動生成 |
| 表示形式 | テキストカード（1-2個のアドバイス） |
| 技術 | AI対話完了後に評価APIを呼び出し |

**アドバイス生成ロジック**:

```
入力: KY対話結果（危険項目、対策、行動目標）

評価観点:
1. 具体性 - 危険が具体的か？（「落ちる」vs「布板設置時に足を滑らせて落ちる」）
2. 網羅性 - 複数の視点で危険を考えているか？（墜落だけでなく落下物も）
3. 対策の実行可能性 - 「気をつける」ではなく具体的行動か？
4. 天候・状況の考慮 - 今日の天候を踏まえているか？

出力: 1-2個の改善アドバイス（テキスト）
```

**アドバイス例**:

| パターン | アドバイス例 |
|----------|-------------|
| 危険が抽象的 | 💡「落ちる」→「どの作業の時に？」を考えるとより具体的になります |
| 対策が曖昧 | 💡「気をつける」→「何を・どうする」で書くと実行しやすくなります |
| 視点が少ない | 💡 今日は風が強いです。資材の落下リスクも考えてみましょう |
| 良いKY | ✨ 具体的な危険と対策が挙げられています。Good KY！ |

**AIプロンプト（アドバイス生成用）**:

```
あなたはKY（危険予知）活動のアドバイザーです。
作業員が行ったKYの内容を評価し、質を向上させるアドバイスを1-2個提供してください。

【評価するKY内容】
- 作業: {work_type}
- 天候: {weather}
- 危険項目: {hazards}
- 対策: {countermeasures}
- 行動目標: {action_goal}

【アドバイスのルール】
- 否定せず、ポジティブな提案をする
- 1つのアドバイスは30文字以内
- 具体的な改善行動を示す
- 良いKYの場合は褒める

【出力形式】
JSON配列で返す:
[{"type": "improvement", "message": "..."}, ...]
typeは "improvement" または "praise"
```

#### FR-08: PDF生成

| 項目 | 内容 |
|------|------|
| 説明 | KY記録をPDF形式で出力 |
| 技術 | jsPDF または html2pdf.js |
| フォーマット | A4縦、会社ロゴなし（シンプル） |
| 内容 | 日時、天候、危険項目、対策、行動目標 |

#### FR-09: 記録保存

| 項目 | 内容 |
|------|------|
| 説明 | KY記録をクラウドに保存（バックアップ用途） |
| 技術 | Supabase または Firebase |
| 保存項目 | JSON形式で全対話内容 |
| アクセス制御 | **端末ロック（パスコード）により保護されていることを前提とする** |

#### FR-10: 履歴画面

| 項目 | 内容 |
|------|------|
| 説明 | 過去のKY記録を一覧表示 |
| 要素 | 日付リスト、タップでPDF表示 |

---

## 4. 非機能要件

### 4.1 性能

| 項目 | 要件 |
|------|------|
| 音声認識 | 2秒以内に開始 |
| AI応答 | 3秒以内 |
| KY完了時間 | 5分以内（目標） |

### 4.2 ユーザビリティ

| 項目 | 要件 |
|------|------|
| 学習時間 | 説明なしで使える |
| 操作 | 3タップ以内でKY開始 |
| ボタンサイズ | 指で押しやすいサイズ（44px以上） |
| フォント | 大きめ（16px以上） |

### 4.3 互換性

| 項目 | 要件 |
|------|------|
| 対応OS | iOS 15以上 |
| 対応ブラウザ | Safari |
| 画面サイズ | iPhone SE（375×667px） |

### 4.4 セキュリティ

| 項目 | 要件 |
|------|------|
| 通信 | HTTPS必須 |
| 認証 | 不要（MVP） |
| 個人情報 | 氏名等は保存しない |

---

## 5. データモデル（MVP）

### 5.1 KY記録

```json
{
  "id": "uuid",
  "created_at": "2026-01-21T08:00:00+09:00",
  "work_type": "scaffold_installation",
  "weather": {
    "condition": "晴れ",
    "temperature": 5,
    "wind_speed": 3
  },
  "hazards": [
    {
      "description": "布板設置時にバランスを崩して落ちる",
      "priority": "high"
    }
  ],
  "countermeasures": [
    "安全帯を親綱にかける",
    "足元を確認してから移動"
  ],
  "action_goal": "安全帯ヨシ！",
  "duration_seconds": 240,
  "conversation_log": [
    {
      "role": "assistant",
      "content": "今日は晴れですね..."
    },
    {
      "role": "user", 
      "content": "落ちるかも"
    }
  ]
}
```

---

## 6. 技術構成

### 6.1 フロントエンド

| 技術 | 用途 |
|------|------|
| PWA | オフライン対応、ホーム画面追加 |
| HTML/CSS/JS | シンプルな構成 |
| Web Speech API | 音声認識・合成 |
| jsPDF | PDF生成 |

### 6.2 バックエンド

| 技術 | 用途 |
|------|------|
| Cloudflare Workers | API、低コスト |
| または Vercel Edge Functions | |
| OpenAI API | AI対話 |

### 6.3 データベース

| 技術 | 用途 |
|------|------|
| Supabase（Free Tier） | KY記録保存 |
| または Cloudflare D1 | |

### 6.4 外部API

| API | 用途 | 費用 |
|-----|------|------|
| OpenAI GPT-4o-mini | AI対話 | ~¥4/回 |
| OpenWeatherMap | 天候取得 | Free Tier |

---

## 7. 画面設計（ワイヤーフレーム）

### 7.1 ホーム画面

```
┌─────────────────────────┐
│                         │
│    Voice KY Assistant   │
│                         │
│  ┌───────────────────┐  │
│  │                   │  │
│  │    🎙️ KY開始     │  │
│  │                   │  │
│  └───────────────────┘  │
│                         │
│      ────────────       │
│                         │
│    📋 履歴を見る        │
│                         │
└─────────────────────────┘
```

### 7.2 AI対話画面

```
┌─────────────────────────┐
│  足場設置 KY            │
│  ━━━━━━━━━━━━━━━━━━━━  │
│                         │
│  ┌───────────────────┐  │
│  │ 🤖 今日は晴れで風 │  │
│  │ が少し強いですね。│  │
│  │ どんな危険があり  │  │
│  │ そうですか？      │  │
│  └───────────────────┘  │
│                         │
│  ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │
│                         │
│  ┌───────────────────┐  │
│  │ 👤 落ちるかも     │  │
│  └───────────────────┘  │
│                         │
│  ━━━━━━━━━━━━━━━━━━━━  │
│  🎙️ ●●●●○○ マイクON   │
│                         │
│  [🔄 やり直し]         │
└─────────────────────────┘
```

### 7.3 確認画面（KYアドバイス付き）

```
┌─────────────────────────┐
│  KY内容確認             │
│  ━━━━━━━━━━━━━━━━━━━━  │
│                         │
│  📅 2026/01/21 08:00    │
│  🌤️ 晴れ 5℃ 風速3m    │
│                         │
│  ⚠️ 危険                │
│  ・布板設置時に落ちる   │
│                         │
│  ✅ 対策                │
│  ・安全帯を親綱にかける │
│                         │
│  🎯 合言葉              │
│  「安全帯ヨシ！」       │
│                         │
│  ━━━━━━━━━━━━━━━━━━━━  │
│  💡 KYアドバイス         │
│  ┌───────────────────┐  │
│  │ 今日は風が強いです。│  │
│  │ 資材の落下リスクも  │  │
│  │ 考えてみましょう    │  │
│  └───────────────────┘  │
│                         │
│  ━━━━━━━━━━━━━━━━━━━━  │
│  [✏️ 修正] [✅ 完了]   │
└─────────────────────────┘
```

---

## 8. 将来拡張（Phase 2以降）

| 機能 | Phase | 説明 |
|------|-------|------|
| 危険候補提案 | 2 | AIが危険を提案、選択式に |
| スコアリング | 2 | KYの質を評価表示 |
| 複数作業対応 | 2 | 足場解体、重機作業等 |
| 分析ダッシュボード | 3 | 傾向分析・グラフ |
| 国データ活用 | 3 | ヒヤリハットDB連携 |
| チームKY対応 | 3 | 複数人でのKY |

---

## 9. 用語定義

| 用語 | 定義 |
|------|------|
| KY | 危険予知（Kiken Yochi）の略 |
| 足場 | 高所作業用の仮設構造物 |
| 布板 | 足場の作業床 |
| 安全帯 | 墜落防止のハーネス |
| 合言葉 | その日の安全スローガン |
| PWA | Progressive Web App |

---

## 改訂履歴

| Ver | 日付 | 変更内容 |
|-----|------|---------|
| 1.0 | 2026/01/20 | 初版作成 |
| 2.0 | 2026/01/21 | MVP版にブラッシュアップ |
| 2.1 | 2026/01/21 | KYアドバイス機能をMVPに追加 |

---

**承認欄**

| 役職 | 氏名 | 日付 | 承認 |
|------|------|------|------|
| プロジェクトオーナー | | | |
