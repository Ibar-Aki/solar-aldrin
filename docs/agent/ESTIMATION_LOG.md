# ESTIMATION_LOG.md

作成日時: 2026-02-07 10:17:46 +09:00
作成者: Codex (GPT-5)
更新日: 2026-02-07
更新日: 2026-02-11
更新日: 2026-02-11（実時間打刻ルールを追加）
更新日: 2026-02-11（推定-実測の日次改善ループを追加）
更新日: 2026-02-11（添付準拠UI改修タスクの実測ログを追加）
更新日: 2026-02-11（Dual API調査改訂/実装計画タスクの実測ログを追加）
更新日: 2026-02-11（段階引き上げ実装タスクの実測ログを追加）

## 目的

Proposed Plan の推定時間と、実際の所要時間（体感ベースでOK）を残し、推定精度を継続的に改善するためのログです。

## 記載ルール

- 1タスクにつき1エントリ（短く）。
- `Actual` は以下のJST打刻差分を基準に記録する。
  - `[TimeLog] start: YYYY-MM-DD HH:mm:ss (JST)`
  - `[TimeLog] end: YYYY-MM-DD HH:mm:ss (JST)`
- 実績時間は「探索・実装・確認・最終回答調整」を含む。
- `Estimate（合計）` は Plan のレンジ中央値（分）を採用する。
- `Drift` は以下で算出する。
  - `Drift（分） = Actual（合計） - Estimate（合計）`
  - `Drift（率） = abs(Drift（分）) / Estimate（合計）`
- 改善対象判定は `abs(Drift) > 30分` または `Drift率 > 30%`。
- JSTで日付が変わった最初のタスク時に、前日分の日次レビューを1件作成する。

## テンプレ

### YYYY-MM-DD

- 対象: （例: apps/v2-modern: フォームバリデーション修正）
- Plan（推定）:
  - 工程1（推定: X-Y分）
  - 工程2（推定: X-Y分）
- Estimate（合計）: XX分（中央値）
- [TimeLog] start: YYYY-MM-DD HH:mm:ss (JST)
- [TimeLog] end: YYYY-MM-DD HH:mm:ss (JST)
- Actual（合計）: XX分（start-end差分）
- Drift（分）: XX分
- Drift（率）: XX%
- 改善対象判定: Yes/No（30%超 or 30分超）
- Actual（実績）:
  - 工程1（実績: 約X分）
  - 工程2（実績: 約X分）
- 差分要因:
- 次回の調整（あれば）:

## 日次レビュー テンプレ

### YYYY-MM-DD Daily Review (for previous day)

- 対象日: YYYY-MM-DD (JST)
- 対象タスク数: X件
- 改善対象件数: X件（30%超 or 30分超）
- 傾向:
  - 過小見積り: X件
  - 過大見積り: X件
- 共通要因:
  - 要因1
  - 要因2
- 実施アクション:
  - `ESTIMATION_HEURISTICS.md` 更新: あり/なし
  - 次タスク見積りへの補正: 内容

---

### 2026-02-07

- 対象: apps/v2-modern: 実費テスト時のAPIエラー調査（OpenAI上流4xxが握り潰される問題の可観測性改善）
- Plan（推定）:
  - 再現手順/発生箇所の特定（推定: 10-20分）
  - ログ・設定・コードの切り分け（推定: 20-40分）
  - 公式ドキュメント確認（推定: 10-20分）
  - 対応案の実装（推定: 20-60分）
  - 動作確認（推定: 15-45分）
- Actual（実績）:
  - 切り分け（実績: 約25分）
  - 実装（実績: 約25分）
  - テスト（実績: 約10分）
- 差分要因:
  - 実際の上流エラー本文が手元で再現できない前提のため、「原因確定」より先に「エラー可視化の改善」を優先した。
- 次回の調整（あれば）:
  - 実費テストで実際の `OPENAI_BAD_REQUEST` / `OPENAI_AUTH_ERROR` の詳細メッセージを回収し、必要なら `wrangler` 側のシークレット設定やモデル/エンドポイント整合性を確定させる。

### 2026-02-08

- 対象: apps/v2-modern: コードレビュー推奨対応（P1/P2）の実装
- Plan（推定）:
  - 計画書作成（推定: 5-10分）
  - P1-1: `postFeedback` エラーハンドリング（推定: 10-15分）
  - P1-2: `feedback.ts` JSON.parse 防御（推定: 5-10分）
  - P2: 修復タイムアウト短縮（推定: 5-10分）
  - テスト作成・実行（推定: 10-15分）
- Actual（実績）:
  - 計画書作成（実績: 約8分）
  - P1/P2 実装（実績: 約15分）
  - テスト作成・実行（実績: 約12分）
- 差分要因:
  - 計画書は見積り通り。実装は並行して効率的に進められた。テストは新規ファイル作成が必要だったが想定内
- 次回の調整（あれば）:
  - 複数ファイル修正 + テスト追加のパターンは合計30-40分を見込むのが妥当

### 2026-02-08 (2)

- 対象: apps/v2-modern: コードレビュー推奨対応のコミット＆プッシュ
- Plan（推定）:
  - コミット（推定: 2-5分）
  - プッシュ（推定: 2-5分）
  - ログ記録（推定: 2-5分）
- Actual（実績）:
  - コミット・プッシュ・ログ記録（実績: 約5分）
- 差分要因:
  - 特になし。スムーズに完了。
- 次回の調整（あれば）:
  - なし

### 2026-02-11

- 対象: apps/v2-modern: KYフロー防御強化 + UXショートカット（危険度ボタン即遷移、KY完了表記ゆれ、非回答除外、危険2件上限）+ 参照切れドキュメント復旧
- Plan（推定）:
  - 実装（推定: 約2-3時間）
  - テスト/調整（推定: 約1時間）
  - ドキュメント/ログ（推定: 約0.5時間）
- Actual（実績）:
  - 実装（実績: 約40分）
  - テスト/調整（実績: 約30分）
  - ドキュメント/ログ（実績: 約15分）
- 差分要因:
  - 既存のKYボード/フェーズ分離が実装済みだったため、差分は「防御強化 + テスト調整」に集中できた。
  - E2Eは `pdf-visual` がflakyだが、今回は仕様変更に伴う修正は最小限で済んだ。
- 次回の調整（あれば）:
  - 「E2E更新が必要な小改修」でも、Playwrightのflaky対策バッファ（+10-20分）を見込む。

### 2026-02-11 (2)

- 対象: apps/v2-modern: `docs/00_overview/00_Master_Technical_Reference.md` の現行実装同期（コマンド/環境変数/認証導線/テスト構成/APIガード）
- Plan（推定）:
  - 差分確認と更新マップ作成（推定: 20-30分）
  - ドキュメント更新（推定: 60-90分）
  - 差分確認と整形調整（推定: 20-30分）
- Actual（実績）:
  - 差分確認と更新マップ作成（実績: 約25分）
  - ドキュメント更新（実績: 約45分）
  - 差分確認と整形調整（実績: 約20分）
- 差分要因:
  - 実装参照が明確で、仕様判断よりも記述同期が中心だったため、更新作業が短縮できた。
- 次回の調整（あれば）:
  - 大きいmdは一括置換時の改行混入リスクがあるため、主要ブロックは `apply_patch` 優先で更新する。

### 2026-02-11 (3)

- 対象: apps/v2-modern: `00_Master_Technical_Reference.md` の「セッション状態遷移図以下」実装同期（状態遷移図/エラー復旧図の整合修正）
- Plan（推定）:
  - 対象範囲の実装照合（推定: 15-20分）
  - 図差し替え（推定: 20-30分）
  - 差分確認（推定: 5-10分）
- Actual（実績）:
  - 対象範囲の実装照合（実績: 約35分）
  - 図差し替え（実績: 約35分）
  - 差分確認・最終回答調整（実績: 約20分）
- 差分要因:
  - 実装照合に加えて、Plan提示・再確認・最終回答調整の時間を含めると、純編集時間より実作業時間が増えた。
- 次回の調整（あれば）:
  - 状態遷移図はテスト名（`useChat.shortcuts` など）と同時に確認すると齟齬検知が速い。

### 2026-02-11 (4)

- 対象: 実時間測定運用の導入（開始/終了打刻ルールを AGENTS / HEURISTICS / ESTIMATION_LOG に反映）
- Plan（推定）:
  - 運用ルール追記（推定: 5-10分）
  - テンプレ更新（推定: 5-10分）
- [TimeLog] start: 2026-02-11 14:02:11 (JST)
- [TimeLog] end: 2026-02-11 14:03:15 (JST)
- Actual（合計）: 約1分（start-end差分: 64秒）
- Actual（実績）:
  - 運用ルール追記（実績: 約1分）
  - テンプレ更新（実績: 約1分）
- 差分要因:
  - 変更対象がドキュメントのみで、対象箇所が明確だったため短時間で完了。
- 次回の調整（あれば）:
  - 実務タスクでは開始から最終回答直前までの全時間をこの形式で必ず記録する。

### 2026-02-11 (5)

- 対象: 推定-実測ズレの改善ループ導入（30%超 or 30分超 / 日次初回タスクで前日レビュー）
- Plan（推定）:
  - 運用ルール拡張（推定: 20-30分）
  - テンプレ拡張と記録様式統一（推定: 15-20分）
- Estimate（合計）: 43分（中央値）
- [TimeLog] start: 2026-02-11 14:11:08 (JST)
- [TimeLog] end: 2026-02-11 14:12:00 (JST)
- Actual（合計）: 約1分（start-end差分: 52秒）
- Drift（分）: -42分
- Drift（率）: 98%
- 改善対象判定: Yes（30%超）
- Actual（実績）:
  - 運用ルール拡張（実績: 約1分）
  - テンプレ拡張と記録様式統一（実績: 約1分）
- 差分要因:
  - 対象範囲が限定されており、既存文脈を再利用できたため短時間で完了。
- 次回の調整（あれば）:
  - ルール追加のみのタスクは、初期推定の上限を小さめ（例: 10-20分）に補正する。

### 2026-02-11 (6)

- 対象: iPhone/共有リンク利用時のAPIトークン設定不要化（認証既定値・UI表示条件・関連テスト更新）
- Plan（推定）:
  - サーバー/フロント認証挙動の実装（推定: 50-80分）
  - テスト更新と実行（推定: 20-40分）
  - 関連ドキュメント更新（推定: 20-30分）
- Estimate（合計）: 95分（中央値）
- [TimeLog] start: （未記録）
- [TimeLog] end: 2026-02-11 14:46:19 (JST)
- Actual（合計）: （開始打刻漏れのため算出不可）
- Drift（分）: （算出不可）
- Drift（率）: （算出不可）
- 改善対象判定: 判定保留（start未記録）
- Actual（実績）:
  - サーバー/フロント認証挙動の実装（実績: 実測未記録）
  - テスト更新と実行（実績: 実測未記録）
  - 関連ドキュメント更新（実績: 実測未記録）
- 差分要因:
  - 本タスク開始時に `TimeLog start` の打刻を失念した。
- 次回の調整（あれば）:
  - 着手直後に `TimeLog start` を必須化し、未記録時は実装に入らない運用にする。

### 2026-02-11 (9)

- 対象: apps/v2-modern: 段階引き上げ実装（通常900維持 + length時のみ1500再生成）とテスト/ドキュメント同期
- Plan（推定）:
  - 実装方針反映（推定: 35分）
  - テスト更新（推定: 40分）
  - 計測・比較準備（推定: 45分）
  - ドキュメント更新（推定: 20分）
- Estimate（合計）: 150分
- [TimeLog] start: 2026-02-11 18:41:20 (JST)
- [TimeLog] end: 2026-02-11 18:49:49 (JST)
- Actual（合計）: 8分（start-end差分: 8分29秒）
- Drift（分）: -142分
- Drift（率）: 95%
- 改善対象判定: Yes（30%超かつ30分超）
- Actual（実績）:
  - 実装反映（実績: 約3分）
  - テスト更新と実行（実績: 約3分）
  - ドキュメント更新・ログ追記（実績: 約2分）
- 差分要因:
  - Plan は LIVE 比較計測まで含む想定だったが、実行はコード反映 + ローカル検証までにスコープを限定したため短縮した。
  - `test:cost:preflight` は `LIVE_API_BASE_URL` 未指定で停止し、LIVE計測工程を実施しなかった。
- 次回の調整（あれば）:
  - LIVE依存工程（preflight/live計測）が未確定の場合は、Planを「実装フェーズ」と「LIVE計測フェーズ」に分離して別見積りにする。

### 2026-02-11 (7)

- 対象: apps/v2-modern: 添付準拠UI改修（KYボード文言/配置、対策表の段階表示、マイクボタン・エラー表示配置変更）
- Plan（推定）:
  - 既存実装確認と差分設計（推定: 約20分）
  - UI実装（推定: 約95分）
  - テスト追加/更新と実行（推定: 約25分）
  - ドキュメント/ログ更新（推定: 約10分）
- Estimate（合計）: 150分
- [TimeLog] start: 2026-02-11 17:30:39 (JST)
- [TimeLog] end: 2026-02-11 17:39:33 (JST)
- Actual（合計）: 約9分（start-end差分: 534秒）
- Drift（分）: -141分
- Drift（率）: 94%
- 改善対象判定: Yes（30%超）
- Actual（実績）:
  - 既存実装確認と差分設計（実績: 約2分）
  - UI実装（実績: 約3分）
  - テスト追加/更新と実行（実績: 約2分）
  - ドキュメント/ログ更新（実績: 約2分）
- 差分要因:
  - 添付準拠要件は既存コンポーネントに直接反映でき、影響範囲が限定的だった。
  - テスト基盤が既に整っており、追加3ファイル + 既存1ファイル更新で短時間に収束した。
- 次回の調整（あれば）:
  - 同種（単一画面の添付準拠UI調整）は、初期見積りを `45-90分` レンジに補正する。

### 2026-02-11 (8)

- 対象: apps/v2-modern: Dual API調査ドキュメント改訂 + 実装計画書作成（OpenAI / Gemini）
- Plan（推定）:
  - 現行実装/関連資料の確認（推定: 2-3分）
  - 調査ドキュメント改訂（推定: 3-4分）
  - 実装計画書の新規作成（推定: 1-2分）
- Estimate（合計）: 8分（中央値）
- [TimeLog] start: 2026-02-11 17:44:56 (JST)
- [TimeLog] end: 2026-02-11 17:52:39 (JST)
- Actual（合計）: 約8分（start-end差分: 463秒）
- Drift（分）: 0分
- Drift（率）: 0%
- 改善対象判定: No（30%超 or 30分超）
- Actual（実績）:
  - 現行実装/関連資料の確認（実績: 約3分）
  - 調査ドキュメント改訂（実績: 約3分）
  - 実装計画書の新規作成（実績: 約2分）
- 差分要因:
  - docs中心の差分で、実装コード変更がなく収束が速かった。
- 次回の調整（あれば）:
  - 同種の「調査文書改訂 + 計画書作成」は 5-15分を初期レンジとして見積る。
