# ESTIMATION_HEURISTICS.md

作成日時: 2026-02-07 10:17:46 +09:00
作成者: Codex (GPT-5)
更新日: 2026-02-07
更新日: 2026-02-11（実時間打刻を実績記録の基準に追加）
更新日: 2026-02-11（推定-実測の日次改善ループを追加）
更新日: 2026-02-11（添付準拠UIの局所改修に対する見積り補正式を追加）
更新日: 2026-02-11（LIVE依存工程を分離見積りする補正式を追加）
更新日: 2026-02-11（既存フローの局所修正タスクに対する見積り補正式を追加）
更新日: 2026-02-11（KYボード文言/プレースホルダー追加の小規模UI改修に対する見積り補正式を追加）
更新日: 2026-02-11（進捗バーへの外部リンクボタン追加タスクに対する見積り補正式を追加）
更新日: 2026-02-11（入力フォーカス比較モックUI追加タスクに対する見積り補正式を追加）
更新日: 2026-02-11（共通UIスタイル本番適用タスクに対する見積り補正式を追加）
更新日: 2026-02-12（KYボード指標UIの再配置タスクに対する見積り補正式を追加）
更新日: 2026-02-14（既存ロジックの責務分割タスクに対する見積り補正式を追加）
更新日: 2026-02-14（実費確認+局所リファクタ+CORS強化タスクに対する見積り補正式を追加）

## 目的
推定作業時間（CODEX high）の「ざっくり見積り」を継続的に補正するための、簡易ルール集です。

## 基本ルール（初期版）
- 調査が絡む（仕様不明、影響範囲不明、再現が必要）: 幅を広めに取る（例: 10-30分以上）。
- 実装だけで終わらない可能性が高い場合（ビルド/型/リント/テストの修正が連鎖）: 実装工程にバッファを追加（例: +10-30分）。
- テスト追加やE2E確認が必要: 「テスト/動作確認」工程を独立させ、別枠で見積る（例: 10-45分）。
- 添付スクリーンショット準拠の **局所UI調整**（既存コンポーネントが特定済み）の場合:
  - 初期見積りは `45-90分` を基準にする（2時間超は「複数画面改修 or E2E再収録」がある場合のみ）。
  - 文言変更 + レイアウト微調整 + unitテスト追加までなら `60分前後` を第一候補にする。
- LIVE環境依存の検証（`test:cost:preflight` / `test:cost:live` 等）が必要な場合:
  - 「実装フェーズ」と「LIVE検証フェーズ」を分離して見積る。
  - APIベースURLやトークンが未確定の時点では、LIVE検証フェーズを「条件付きタスク」として別建てにする。
- 既存会話フローの **局所修正**（対象ファイルが事前特定済み、状態遷移の追加/条件分岐の差し替え、unitテスト2-4件追加）:
  - 初期見積りは `45-90分` を第一候補にする。
  - 3時間超の見積りは「新規コンポーネント大量追加」または「E2E再収録/複数画面改修」がある場合に限定する。
- KYボードの **文言/プレースホルダー追加** のような小規模UI改修（単一コンポーネント + 既存unit更新）:
  - 初期見積りは `20-40分` を第一候補にする。
- 進捗バーなど既存UIへの **外部リンクボタン追加**（単一画面 + テスト1件）:
  - 初期見積りは `15-30分` を第一候補にする。
- 候補選定用の **比較モックUI追加**（既存コンポーネント再利用・機能ロジックなし・テスト1件）:
  - 初期見積りは `20-35分` を第一候補にする。
- 共通コンポーネントへの **スタイル本番適用**（Input/Textareaなど2-3ファイル集約 + 回帰テスト）:
  - 初期見積りは `15-30分` を第一候補にする。
- KYボード等の **指標UI再配置**（単一コンポーネントで配置替え + 既存unit更新 + lint/test/build）:
  - 初期見積りは `15-35分` を第一候補にする。
- 既存サーバーロジックの **責務分割/モノリス分解**（機能追加なし・挙動維持・回帰テスト追加）:
  - 初期見積りは `60-120分` を第一候補にする。
  - 3時間超の見積りは「新規仕様追加」「複数ルート同時改修」「外部I/F変更」がある場合に限定する。
- **実費テスト確認 + 局所リファクタ + CORS hardening**（既存シナリオ/既存テスト活用、仕様追加なし）:
  - 初期見積りは `90-180分` を第一候補にする。
  - 6時間超の見積りは「新規機能追加」または「大規模UI改修」が同時に入る場合に限定する。
- 実績（Actual）は体感見積りではなく、`[TimeLog] start` と `[TimeLog] end`（JST）の差分を採用する。
- 実績時間は「探索・実装・確認・最終回答調整」までを含め、純編集時間のみで算出しない。
- 改善対象判定は「|Drift| > 30分 または Drift率 > 30%」を使用する。
  - Drift分 = `Actual（合計） - Estimate（合計）`
  - Drift率 = `abs(Drift分) / Estimate（合計）`

## 日次改善ループ（JST）
- トリガー: 日付が変わった最初のタスク開始時に、前日完了分をレビューする。
- 日次レビューで行うこと:
  - 改善対象件数（30%超 or 30分超）を数える。
  - 過小見積り/過大見積りの偏りを確認する。
  - 共通要因（調査長期化、テスト待機、仕様往復など）を抽出する。
- 反映条件:
  - 同系統のズレが2件以上、または単発でも `Drift率 > 100%` かつ `|Drift| > 60分`。
- 反映先:
  - `docs/agent/ESTIMATION_HEURISTICS.md` の基本ルール追記/修正
  - `docs/agent/ESTIMATION_LOG.md` の日次レビューエントリ記録

## 改善のやり方
- `docs/agent/ESTIMATION_LOG.md` の差分要因から、再発しやすいズレ（例: ビルドが遅い、依存更新が必要）を抽出して、このファイルに追記します。
- ルールを更新した場合は、更新日を最上部に追記します（例: `更新日: 2026-02-07`）。
