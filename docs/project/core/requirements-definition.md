# Voice KY Assistant 要件定義書

作成日: 2026-01-14
更新日: 2026-02-07（ファイル整理：配置/ファイル名変更）

本ドキュメントは **Voice KY Assistant** の機能要件、業務フロー、データ要件、非機能要件、受入条件、例外・エラー対応を定義する。

---

## 1. 目的と前提

### 1.1 目的

* 音声対話で危険予知（KY）を作成し、現場の負担を削減する。
* AIが新たな視点を提供し、一人KYのマンネリ化を防止する。
* 監査に耐える記録を自動生成し、再利用できるデータとして蓄積する。

### 1.2 前提

* 本書はPhase 1〜Phase 4の全体要件を定義し、Phase 2を主要な開発対象とする。
* 各要件の適用範囲は「フェーズ」欄で明示する。
* ネットワーク不安定な現場を想定し、入力内容の消失を防止する。
* データは長期保管せず、月1回のエクスポート後に削除することを想定する。

### 1.3 フェーズ定義（要約）

| フェーズ | テーマ | 利用規模 |
|:---|:---|:---|
| Phase 1 | 音声対話の実現可能性検証（MVP） | 1人（開発者） |
| Phase 2 | ソロKYの安定運用と定着 | 1〜10人 |
| Phase 3 | 二度書き削減（OCR/画像）、組織展開 | 10〜100人 |
| Phase 4 | チームKY（複数人対話）、分析ダッシュボード | 100〜200人以上 |

---

## 2. ユーザーと権限

| ロール | 想定ユーザー | 主な権限 |
|:---|:---|:---|
| 作業員 | 現場作業者 | KY作成、PDF保存 |
| 現場長 | 現場責任者 | KY作成、PDF保存、記録の確認、エクスポート |
| 管理者 | 管理部門 | 運用ポリシー設定、監査対応、データ管理 |

---

## 3. 機能要件

| ID | 機能名 | 概要 | フェーズ | 受入条件 |
|:---|:---|:---|:---|:---|
| FR-01 | 音声対話KY | 音声入力に対してAIが質問し、KY記録を作成する。 | Phase 2 | 5分以内の対話で必須項目が埋まること |
| FR-02 | 深掘り質問 | 抽象的回答に対して具体化質問を行う。 | Phase 2 | 「ヨシ」など曖昧回答が3回以上続かないこと |
| FR-03 | PDF自動生成 | 対話完了後にPDFを生成する。 | Phase 2 | 必須項目がPDFに反映され、1分以内に生成されること |
| FR-04 | 新たな視点の提供 | KYまとめ時にAIが過去事例や一般的な危険を提示する。 | Phase 2 | まとめ画面で視点が提示されること |
| FR-05 | データエクスポート | KY記録をCSV/Excel形式で一括ダウンロードする。 | Phase 3 | 全記録が正しくエクスポートされること |
| FR-06 | 他社KY取り込み | 他社指定KY用紙をOCRで取り込み自社項目に変換する。 | Phase 3 | OCR結果の確認・修正が可能であること |
| FR-07 | 現場写真診断 | 画像認識で危険箇所を指摘する。 | Phase 3 | 指摘内容がKY項目として保存されること |
| FR-08 | チームKY | 1台のデバイスを共有し、複数人の意見をAIが統合してKYにまとめる。 | Phase 4 | 3人以上の意見が1つのKY記録に統合されること |
| FR-09 | 分析ダッシュボード | 組織横断でKYデータを集計・可視化する。 | Phase 4 | 期間・現場別の集計グラフが表示されること |

---

## 4. 業務フロー

### 4.1 ソロKY（標準フロー）

1. **起動**: アプリを開き「KY開始」を押す。
2. **基本情報入力**: 作業内容・場所・日時を音声入力する。
3. **対話**: AIが危険ポイントと対策を質問する。
4. **新たな視点の確認**: AIが提示する追加の視点を確認する。
5. **確認**: PDFプレビューで内容を確認する。
6. **保存/共有**: PDFを保存または共有する。

### 4.2 チームKY（Phase 4）

1. **起動**: 班長がアプリを開き「チームKY開始」を押す。
2. **参加者確認**: 参加人数を入力する。
3. **対話**: AIの質問に対し、メンバーが順番または自由に発言する。
4. **意見統合**: AIが発言を統合し、KY記録の素案を作成する。
5. **確認・修正**: 班長が内容を確認・修正する。
6. **保存/共有**: PDFを保存または共有する。

### 4.3 例外フロー（音声認識失敗）

1. 音声認識に失敗した場合、画面に再入力ボタンを表示する。
2. ユーザーは再入力を選択し、テキスト入力に切り替えられる。
3. 再入力した内容は音声入力と同じ項目に反映される。

---

## 5. データ要件

### 5.1 必須項目

* 作業内容
* 作業場所
* 作業日時
* 危険ポイント
* 対策内容

### 5.2 保存期間

| フェーズ | 保存場所 | 保存期間 | 備考 |
|:---|:---|:---|:---|
| Phase 1-2 | 端末ローカル | 30日 | 削除前に通知 |
| Phase 3以降 | サーバー | 30日 | 月1回エクスポート後に削除 |

> **運用想定**: データはExcel等の他媒体で長期管理するため、アプリ内での長期保管は不要。

### 5.3 エクスポート機能

* **形式**: CSV、Excel（.xlsx）
* **対象**: 指定期間内の全KY記録
* **実装フェーズ**: Phase 3

### 5.4 データ整合性

* PDFと画面表示内容が一致していること。
* 改ざん防止のためのハッシュ付与はPhase 3以降で必須。

---

## 6. 非機能要件

### 6.1 レスポンス速度

* 音声入力完了からAI応答開始まで3秒以内。

### 6.2 操作性

* 手袋モードを前提とした大きなボタン配置。
* 二重タップ防止。

### 6.3 環境耐性

* 騒音下でも音声認識が可能であること。
* オフライン時の入力内容保持。

### 6.4 セキュリティ

* APIキーは必ずBFFを経由しクライアントには保持させない。
* 現場写真は解析後に削除、または暗号化保存する。

### 6.5 可用性・復旧性

* Phase 3以降で障害復旧目標（RTO）: 4時間以内を目標。
* バックアップはサーバー保存開始後に日次取得する。

### 6.6 監査ログ

* Phase 3以降でPDF生成、保存、削除、エクスポートの操作ログを記録する。

### 6.7 コスト制約

* KY 1回あたり平均5円以下（インフラ費用込み）を目標。
* 高品質機能（新たな視点の提供等）では7円程度まで許容。

---

## 7. 例外・エラー対応

| エラー種別 | 想定原因 | 影響 | 対策 |
|:---|:---|:---|:---|
| 音声認識失敗 | 騒音、マイク不良 | 入力不能 | 再入力UIとテキスト入力切替 |
| PDF生成失敗 | 生成処理の例外 | 記録未保存 | 再生成ボタンとエラー通知 |
| データ保存失敗 | ストレージ容量不足 | 記録消失 | 容量警告と削除案内 |
| ネットワーク断 | 通信不安定 | データ送信不可 | オフライン保存と再送 |
| API利用上限超過 | 利用量増大 | サービス停止 | 利用量モニタリング、アラート通知 |

---

## 8. UI/UX 要件

### 8.1 画面構成

* トップ画面（KY開始ボタン）
* 対話画面（チャット形式）
* 新たな視点の提示画面
* PDFプレビュー画面
* エクスポート画面（Phase 3）
* チームKY画面（Phase 4）

### 8.2 視覚フィードバック

* 録音中は波形アニメーションを表示する。
* AI応答中は「確認しますね」などの表示で待機ストレスを軽減する。

---

## 9. 受入基準のまとめ

### Phase 1（MVP）

* FR-01、FR-02の受入条件を満たすこと。
* 音声対話で必須項目が埋まること。

### Phase 2

* FR-01〜FR-04の受入条件を満たすこと。
* PDF生成成功率99%以上。
* 音声入力成功率95%以上。
* AIによる新たな視点が提示されること。

### Phase 3

* FR-05〜FR-07の受入条件を満たすこと。
* エクスポート機能が正常に動作すること。

### Phase 4

* FR-08〜FR-09の受入条件を満たすこと。
* チームKYで3人以上の意見が統合されること。

