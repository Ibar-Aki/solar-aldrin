# Voice KY Assistant: Requirements Definition

本ドキュメントは、**Voice KY Assistant** の機能要件、業務フロー、および非機能要件を定義します。

---

## 1. 機能要件一覧 (Functional Requirements)

| ID | 機能名 | 概要 | フェーズ |
| :--- | :--- | :--- | :--- |
| **FR-01** | **音声対話KY** | ユーザーの音声入力に対し、AIが適切な質問を投げかけ、KY記録を作成する。 | Phase 2 |
| **FR-02** | **深掘り質問** | 抽象的な回答（「ヨシ！」等）に対し、「具体的には？」「もし〜だったら？」と深掘りする。 | Phase 2 |
| **FR-03** | **PDF自動生成** | 対話完了後、監査に耐えうる形式のKY記録票（PDF）を即座に生成する。 | Phase 2 |
| **FR-04** | **他社KY取り込み** | カメラで他社（元請け）指定のKY用紙を撮影し、記載内容をOCRで読み取り、自社データとして取り込む。不足項目はAIが指摘する。 | **Phase 3** |
| **FR-05** | **現場写真診断** | 現場の写真を撮影すると、AIが画像認識で危険箇所（不安全状態）を指摘する。 | **Phase 3** |
| **FR-06** | **チームKY** | 複数人（職長＋班員）の会話をAIが聞き取り、誰の発言かを推測しつつKY記録にまとめる。 | **Phase 4** |
| **FR-07** | **類似事例リコメンド** | 「この作業なら、過去に〇〇現場でこんな事故があった」とAIが組織の過去データから注意喚起する。 | **Phase 4** |

---

## 2. 業務フロー (User Flows)

### Flow A: ソロKY（標準フロー）

Phase 2の基本形です。

1. **起動**: アプリを開き「KY開始」ボタンを押す。
2. **基本情報**: 「今日の作業は？」→「足場組立てです」
3. **対話**:
    * AI: 「一番の危険ポイントは？」
    * User: 「手摺がないところでの作業かな」
    * AI: 「そこでの対策は？」
    * User: 「安全帯を必ずかける」
4. **生成**: PDFがプレビューされ、OKなら保存/共有。

### Flow B: 他社KY取り込み（Phase 3）

「二度書き」を解消するキラー機能です。

1. **撮影**: 元請け指定の手書きKY用紙（記入済）をスマホで撮影。
2. **解析**: AIが内容を読み取り、自社システムの項目にマッピング。
3. **補完 (Gap Filling)**:
    * AI: 「『点検ヨシ』とありますが、具体的にどこのボルトを確認しますか？」
    * AI: 「自社基準では『足場解体』のリスクも挙げる必要があります」
4. **完了**: 不足分を会話で埋め、自社用データとして登録完了。

---

## 3. 非機能要件 (Non-Functional Requirements)

### NFR-01: レスポンス速度

* 音声入力完了からAI応答開始まで **3秒以内** であること。
* 思考を途切れさせないため、Streaming（逐次表示/再生）を活用する。

### NFR-02: 操作性 (Accessibility)

* **手袋モード**: 軍手をしたままでも押せる巨大なボタン配置（MicButton）。
* **誤操作防止**: 二重タップ防止、スワイプ操作の排除。

### NFR-03: 環境耐性

* **騒音**: 建設現場の騒音下でも音声認識できるよう、ノイズキャンセリングやWeb Speech APIの特性を活用。
* **オフライン**: 電波不安定な場所でも、入力内容が消失しないこと（Local Storage活用）。

### NFR-04: セキュリティ

* **APIキー隠蔽**: クライアント側にAPIキーを持たせず、必ずBFF（Cloudflare Workers）を経由する。
* **画像プライバシー**: 現場写真や書類写真は、解析後即座に破棄するか、セキュアなストレージ（R2）に暗号化保存する。

---

## 4. UI/UX コンセプト

* **Chat-Centric**: 複雑なフォームは排除し、LINEのようなチャットUIをベースにする。
* **Visual Feedback**: 録音中は波形アニメーションを表示し、「聞いている」ことを視覚的に伝える。
* **Filler**: AIの思考中、「えーっと...」「確認しますね」といったフィラー（繋ぎ言葉）を挟み、待機ストレスを軽減する。
